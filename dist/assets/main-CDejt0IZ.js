(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))r(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const o of e.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function s(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function r(t){if(t.ep)return;t.ep=!0;const e=s(t);fetch(t.href,e)}})();function D(n){const i=n.currentTarget,s=i.previousElementSibling;console.log("Show Password Button Clicked:",i),console.log("Password Input Element:",s),s?s.type==="password"?(s.type="text",i.querySelector(".fa-eye-slash").classList.remove("hide"),i.querySelector(".fa-eye").classList.add("hide")):(s.type="password",i.querySelector(".fa-eye-slash").classList.add("hide"),i.querySelector(".fa-eye").classList.remove("hide")):console.error("Password input not found.")}const V="https://v2.api.noroff.dev",R=`${V}/auth`,Y=`${R}/login`,W=`${R}/register`,O=()=>{const n=document.getElementById("login-email"),i=document.getElementById("login-password"),s=document.querySelector(".show-password"),r=document.getElementById("login-error"),t=document.getElementById("login-btn");return{email:n,password:i,showPasswordBtn:s,errorMessage:r,loginBtn:t}},K=()=>{const n=document.getElementById("username"),i=document.getElementById("register-email"),s=document.getElementById("register-password"),r=document.querySelector(".show-password"),t=document.getElementById("error-message"),e=document.getElementById("success-message"),o=document.getElementById("register-btn");return{username:n,email:i,password:s,showPasswordBtn:r,errorMessage:t,successMessage:e,registerBtn:o}};function Q(){const{username:n,email:i,password:s,showPasswordBtn:r,errorMessage:t,successMessage:e,registerBtn:o}=K();if(!r||!s){console.error("Required elements for show-password functionality are missing.");return}r.addEventListener("click",D),o.addEventListener("click",async function(m){if(m.preventDefault(),t.style.display="none",e.style.display="none",n.value.length<2||i.value.length<2||s.value.length<2){t.style.display="block",t.innerHTML="All fields must be filled in.",console.log("All fields must be filled in.");return}if(s.value.length<9){t.innerHTML="The password must contain more than 9 characters.",t.style.display="block",console.log("The password must contain more than 9 characters.");return}if(s.value.length>20){t.innerHTML="The password must contain less than 20 characters.",t.style.display="block",console.log("The password must contain less than 20 characters.");return}if(!i.value.includes("@stud.noroff.no")){t.innerHTML="The email must end with @stud.noroff.no.",t.style.display="block",console.log("The email must end with @stud.noroff.no.");return}if(!/^[a-zA-Z0-9]+$/.test(n.value)){t.innerHTML="The username must only contain letters and numbers.",t.style.display="block",console.log("The username must only contain letters and numbers.");return}const g={name:n.value,email:i.value,bio:"Default bio",avatar:{url:"https://github.com/elanetto/FED1-PE1-elanetto/blob/main/assets/images/user/avatar-user-default.png?raw=true",alt:"User  Avatar"},banner:{url:"https://github.com/elanetto/FED1-PE1-elanetto/blob/main/assets/images/200kb-images/kewater_view-01.jpg?raw=true",alt:"User  Banner"},venueManager:!0,password:s.value};try{const a=await fetch(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(g)}),u=await a.json();if(console.log(u),u.errors){console.log(u.errors),t.style.display="block",t.innerHTML=u.errors.map(f=>f.message).join("<br>"),console.log(u.errors);return}a.ok&&(e.style.display="block",console.log("User registered successfully."),alert("User registered successfully. You will be redirected to the login page."),setTimeout(()=>{window.location.href="../login/"},2e3))}catch(a){console.log(a),t.style.display="block",t.innerHTML="Something went wrong. Please try again."}document.querySelector(".register-form").reset()})}async function z(){const n=localStorage.getItem("token"),i=localStorage.getItem("username"),s=localStorage.getItem("api_key");if(!n||!i||!s)return console.error("Missing authentication data."),null;const r=new Headers;r.append("Authorization",`Bearer ${n}`),r.append("X-Noroff-API-Key",s);try{const t=await fetch(`https://v2.api.noroff.dev/auction/profiles/${i}`,{method:"GET",headers:r});if(!t.ok)throw new Error(`Failed to fetch profile data: ${t.status}`);const e=await t.json();localStorage.setItem("credits",e.data.credits),localStorage.setItem("listingsCount",e.data._count.listings),localStorage.setItem("winsCount",e.data._count.wins);const o=document.querySelector(".my-credits");return o&&(o.textContent=e.data.credits),e.data}catch(t){return console.error("Error fetching profile data:",t),null}}function Z(){const{email:n,password:i,showPasswordBtn:s,errorMessage:r,loginBtn:t}=O();if(!n||!t||!r||!i||!s)return;const e=s.querySelector(".fa-eye-slash"),o=s.querySelector(".fa-eye");if(!e||!o)return;function m(){i.type==="password"?(e.classList.add("hide"),o.classList.remove("hide")):(e.classList.remove("hide"),o.classList.add("hide"))}m(),s.removeEventListener("click",D),s.addEventListener("click",D),t.addEventListener("click",async function(g){var y,h;g.preventDefault();const a=n.value.trim(),u=i.value.trim();if(!ee(a)){r.textContent="Email not valid",r.style.display="block";return}if(u.length===0){r.textContent="Please enter a password",r.style.display="block";return}const f={email:a,password:u};try{const l=await fetch(Y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}),d=await l.json();if(l.ok){if(localStorage.setItem("username",d.data.name),localStorage.setItem("email",d.data.email),localStorage.setItem("avatar",d.data.avatar.url),localStorage.setItem("banner",d.data.banner.url),localStorage.setItem("token",d.data.accessToken),localStorage.setItem("bio",d.data.bio),!await z()){r.textContent="Failed to load profile data. Please refresh the page.",r.style.display="block";return}window.location.href="../../account/myaccount/"}else{const c=((h=(y=d.errors)==null?void 0:y[0])==null?void 0:h.message)||"An error occurred during login.";r.textContent=c,r.style.display="block"}}catch{r.textContent="An error occurred with your login request.",r.style.display="block"}})}function ee(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)}function te(){const n=localStorage.getItem("username"),i=localStorage.getItem("email"),s=localStorage.getItem("avatar"),r=localStorage.getItem("banner"),t=localStorage.getItem("credits"),e=localStorage.getItem("listingsCount"),o=localStorage.getItem("winsCount"),m=localStorage.getItem("bio");document.querySelectorAll(".username-from-local-storage").forEach(p=>{n&&(p.textContent=n)}),document.querySelectorAll(".email-from-local-storage").forEach(p=>{i&&(p.textContent=i)});const u=document.querySelector(".avatar-from-local-storage");s&&u&&(u.src=s),document.querySelectorAll(".my-avatar").forEach(p=>{s&&(p.src=s)});const y=document.querySelector(".banner-from-local-storage");r&&y&&(y.src=r),document.querySelectorAll(".my-credits").forEach(p=>{p.innerText=t}),document.querySelectorAll(".my-listings-count").forEach(p=>{p.innerText=e}),document.querySelectorAll(".my-wins-count").forEach(p=>{p.innerText=o}),document.querySelectorAll(".my-bio").forEach(p=>{p.innerText=m})}function j(){const n=localStorage.getItem("token");if(!n){console.error("No token found");return}const i=n.replace(/['"]+/g,""),s=new Headers;return s.append("Authorization",`Bearer ${i}`),fetch("https://v2.api.noroff.dev/auth/create-api-key",{method:"POST",headers:s,redirect:"follow"}).then(t=>{if(!t.ok)throw new Error(`API key request failed: ${t.status} ${t.statusText}`);return t.json()}).then(t=>{var o;const e=(o=t==null?void 0:t.data)==null?void 0:o.key;if(!e)throw new Error("API key not found in response");return localStorage.setItem("api_key",e),e}).catch(t=>(console.error("Error fetching API key:",t),null))}function N(){const n=localStorage.getItem("token"),i=localStorage.getItem("username");if(!n)return null;const s=n.replace(/['"]+/g,"");if(!i)return null;const r=i.replace(/['"]+/g,"");return{cleanedToken:s,cleanedUsername:r}}function ne(){const n=N();if(!n){console.warn("Token details are not available. Skipping profile picture setup.");return}const{cleanedToken:i,cleanedUsername:s}=n,r=document.getElementById("avatar-input"),t=document.getElementById("change-avatar-button");if(!r||!t){console.warn("Profile picture input or button not found. Skipping setup.");return}t.addEventListener("click",async e=>{e.preventDefault();const o=r.value.trim();if(!o||!oe(o)){alert("Please enter a valid URL.");return}try{const m=await j();if(!m){alert("Unable to fetch API key.");return}const g=new Headers;g.append("Content-Type","application/json"),g.append("X-Noroff-API-Key",m),g.append("Authorization",`Bearer ${i}`);const a=JSON.stringify({avatar:{url:o,alt:"Avatar"}}),u={method:"PUT",headers:g,body:a,redirect:"follow"},f=await fetch(`https://v2.api.noroff.dev/social/profiles/${s}`,u);if(!f.ok)throw console.error("Request failed:",f.status,f.statusText),new Error(`Failed to update profile picture: ${f.status} ${f.statusText}`);const y=await f.json();localStorage.setItem("avatar",o),alert("Your profile picture has been updated!"),location.reload()}catch(m){console.error("An error occurred while updating the profile picture:",m),alert("An error occurred while updating your profile picture.")}})}function oe(n){try{return new URL(n),!0}catch{return!1}}function se(){const n=N();if(!n){console.error("Failed to fetch token details.");return}const{cleanedToken:i,cleanedUsername:s}=n;if(!i||!s){console.error("Token or username is missing.");return}const r=document.getElementById("banner-input"),t=document.getElementById("change-banner-button");if(!r||!t){console.error("Required input or button elements are missing.");return}t.addEventListener("click",async e=>{e.preventDefault();const o=r.value.trim();if(!o||!ie(o)){alert("Please enter a valid URL."),console.error("Invalid or empty URL:",o);return}try{const m=await j();if(!m){console.error("Failed to fetch API key."),alert("Unable to fetch API key.");return}const g=new Headers;g.append("Content-Type","application/json"),g.append("X-Noroff-API-Key",m),g.append("Authorization",`Bearer ${i}`);const a=JSON.stringify({banner:{url:o,alt:"banner"}}),u={method:"PUT",headers:g,body:a,redirect:"follow"},f=await fetch(`https://v2.api.noroff.dev/social/profiles/${s}`,u);if(!f.ok)throw console.error("Request failed:",f.status,f.statusText),new Error(`Failed to update profile picture: ${f.status} ${f.statusText}`);const y=await f.json();localStorage.setItem("banner",o),alert("Your profile banner has been updated!"),location.reload()}catch(m){console.error("Error updating profile banner:",m),alert("An error occurred while updating your banner.")}})}function ie(n){try{return new URL(n),!0}catch{return!1}}const re=()=>{if(document.body.classList.contains("my-account-page")){if(!sessionStorage.getItem("myAccountReloaded")){sessionStorage.setItem("myAccountReloaded","true"),location.reload();return}document.getElementById("avatar-input")&&document.getElementById("change-avatar-button")&&ne(),document.getElementById("banner-input")&&document.getElementById("change-banner-button")&&se()}};async function G(n,i){if(!n){console.error("Listing ID is required to delete the listing.");return}const s=localStorage.getItem("token"),r=localStorage.getItem("api_key");if(!s||!r){console.error("API Key or Token is missing.");return}const t=`https://v2.api.noroff.dev/auction/listings/${n}`;if(console.log(`Attempting to delete listing at: ${t}`),!!confirm("Are you sure you want to delete this listing?"))try{const e=await fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`,"X-Noroff-API-Key":r}});if(e.status===204)console.log("Listing deleted successfully."),alert("Listing deleted successfully."),i.remove();else throw new Error(`Failed to delete the listing. Status: ${e.status}`)}catch(e){console.error("Error deleting listing:",e),alert("Failed to delete the listing. Please try again.")}}function U(n="/account/login/"){return localStorage.getItem("token")?!0:(alert("You need to be logged in to view this listing. Please login or register."),window.location.href=n,!1)}function ae(){if(!U()||!document.body.classList.contains("my-account-page"))return;const n=localStorage.getItem("token"),i=localStorage.getItem("api_key"),s=localStorage.getItem("username");if(!n||!s||!i){console.error("Missing required authentication or user information.");return}const r=n.replace(/['"]+/g,""),t=s.replace(/['"]+/g,"");fetch(`https://v2.api.noroff.dev/auction/profiles/${t}/listings?_bids=true`,{method:"GET",headers:{"X-Noroff-API-Key":i,Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw new Error("Failed to fetch listings");return e.json()}).then(e=>{const o=Array.isArray(e.data)?e.data:[];if(o.length===0){console.warn("No listings found for this user.");return}const m=document.getElementById("my-listings-container");if(!m){console.error("Listings container not found in DOM.");return}m.innerHTML="",o.filter(a=>{const u=a.endsAt?new Date(a.endsAt):null;return u&&u>new Date}).forEach(a=>{var p,w,b,v;const u=document.createElement("div");u.classList.add("flex","flex-col","p-4","bg-white","w-[350px]","rounded","shadow-md");const f=((w=(p=a.media)==null?void 0:p[0])==null?void 0:w.url)||"default-image.jpg",y=(b=a.bids)!=null&&b.length?Math.max(...a.bids.map(I=>I.amount)):"0",h=(v=a.tags)!=null&&v.length?a.tags.join(", "):"N/A",l=a.endsAt;let d="N/A";if(l){const E=new Date(l)-new Date;if(E>0){const S=Math.floor(E/864e5),L=Math.floor(E%(1e3*60*60*24)/(1e3*60*60)),k=Math.floor(E%(1e3*60)/(1e3*60));S>0?d=`${S} day${S>1?"s":""}`:L>0?d=`${L} hour${L>1?"s":""}`:d=`${k} minute${k>1?"s":""}`}else d="Ended"}u.innerHTML=`
                    <a href="/listing/view/index.html?id=${a.id}">
                        <img src="${f}" alt="${a.title}" class="mb-4 rounded object-cover w-full h-[220px]">
                        <h3 class="text-blue-950 font-bold text-lg">${a.title}</h3>
                        <div>
                            <span class="text-blue-950 font-bold">Current Bid:</span>
                            <span>${y} ðŸŒ•</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Description:</span>
                            <span class="italic">${a.description||"No description available"}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Category:</span>
                            <span>${h}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Ends in:</span>
                            <span>${d}</span>
                        </div>
                    </a>
                    <div class="mt-3 h-[50px]">
                        <a href="/listing/edit/index.html?id=${a.id}" class="bg-blue-950 hover:bg-blue-800 text-white rounded px-6 py-2">Edit</a>
                        <button data-listing-id="${a.id}" class="delete-listing-button bg-blue-950 hover:bg-blue-800 text-white rounded px-4 py-1.5 mt-2">Delete</button>
                    </div>
                `;const c=u.querySelector(".delete-listing-button");c&&c.addEventListener("click",()=>G(a.id,u)),m.appendChild(u)})}).catch(e=>{console.error("Error fetching listings:",e)})}document.addEventListener("DOMContentLoaded",async function(){O(),Z(),te(),z(),(document.getElementById("register-form")?K():null)&&Q();const i=localStorage.getItem("username");if(!i)return;const s=i.replace(/['"]+/g,""),r=document.querySelector(".logged-in-username");r&&(r.textContent=`Hello, ${s}! You are currently logged in.`),document.querySelectorAll(".visible-if-logged-in").forEach(e=>{e&&(e.style.display="block")}),re();try{await Promise.all([N(),j()]),ae()}catch(e){console.error("Error fetching required data:",e)}});const le=()=>{const n=document.getElementById("logout-button");n&&n.addEventListener("click",function(){console.log("Logout button clicked"),localStorage.clear(),sessionStorage.clear(),window.location.pathname.endsWith("/index.html")||window.location.pathname==="/"?window.location.reload():window.location.href="../../index.html"})};async function ce(){if(!document.body.classList.contains("create-listing-page"))return;const n=localStorage.getItem("token"),i=localStorage.getItem("api_key"),s=document.getElementById("new-listing-form"),r=document.getElementById("new-listing-title"),t=document.getElementById("new-listing-description"),e=document.getElementById("new-listing-category"),o=document.getElementById("new-listing-ends-at"),m=document.getElementById("new-listing-button");if(!s||!r||!t||!e||!o||!m){console.error("Required elements are missing.");return}m.addEventListener("click",async g=>{var l;g.preventDefault();const a=r.value.trim(),u=t.value.trim(),f=e.value.trim(),y=o.value.trim();if(!a||!u||!f||!y){alert("Please fill in all required fields.");return}const h=[];for(let d=1;d<=3;d++){const c=document.getElementById(`new-listing-image-${d}`).value.trim(),p=document.getElementById(`new-listing-image-alt-${d}`).value.trim();c&&p&&h.push({url:c,alt:p})}if(h.length===0){alert("Please provide at least one image with alt text.");return}try{const d=new Headers({"Content-Type":"application/json","X-Noroff-API-Key":i,Authorization:`Bearer ${n}`}),c=JSON.stringify({title:a,description:u,tags:f.split(",").map(v=>v.trim()),media:h,endsAt:y});console.log("Payload:",c);const p=await fetch("https://v2.api.noroff.dev/auction/listings",{method:"POST",headers:d,body:c});if(!p.ok)throw new Error(`Request failed: ${p.status} ${p.statusText}`);const w=await p.json();console.log("API Response:",w);const b=w.id||((l=w.data)==null?void 0:l.id);b?(alert("New listing created successfully!"),window.location.href=`/listing/view/index.html?id=${b}`):(console.error("Listing ID not found in the response."),alert("Failed to retrieve the listing ID. Please check your response."))}catch(d){console.error("Error creating new listing:",d),alert("Failed to create new listing.")}})}function de(){const n=document.querySelectorAll(".dropdownButton"),i=document.querySelectorAll(".dropdownMenuBottom");if(!n.length||!i.length){console.error("Dropdown buttons or menus not found.");return}n.forEach((s,r)=>{s.addEventListener("click",()=>{const t=i[r];t&&t.classList.toggle("hidden")})}),document.addEventListener("click",s=>{i.forEach((r,t)=>{const e=n[t];!r.contains(s.target)&&!e.contains(s.target)&&r.classList.add("hidden")})})}async function ue(){if(!document.body.classList.contains("view-profile-page"))return;const n=getUsernameFromURL(),i=localStorage.getItem("token"),s=localStorage.getItem("api_key");if(console.log("username: ",n),console.log("token: ",i),console.log("apiKey: ",s),!i)return console.error("No token found. User may not be logged in."),null;const r=new Headers;r.append("Authorization",`Bearer ${i}`),r.append("X-Noroff-API-Key",s);const t={method:"GET",headers:r,redirect:"follow"};try{const e=await fetch(`https://v2.api.noroff.dev/auction/profiles/${n}`,t);if(!e.ok)throw new Error(`Failed to fetch profile data: ${e.status} ${e.statusText}`);const o=await e.json(),m={name:o.data.name,email:o.data.email,avatar:o.data.avatar.url,banner:o.data.banner.url,credits:o.data.credits,listingsCount:o.data._count.listings,winsCount:o.data._count.wins};return localStorage.setItem("credits",o.data.credits),localStorage.setItem("listingsCount",o.data._count.listings),localStorage.setItem("winsCount",o.data._count.wins),localStorage.setItem("avatar",o.data.avatar.url),localStorage.setItem("banner",o.data.banner.url),m}catch(e){return console.error("Error fetching profile data:",e),null}}function ge(n){if(!n)return;const i=document.querySelector(".profile-name");i&&(i.textContent=n.name);const s=document.querySelector(".profile-email");s&&(s.textContent=n.email);const r=document.querySelector(".avatar-profile");n.avatar&&r&&(r.src=n.avatar);const t=document.querySelector(".banner-profile");n.banner&&t&&(t.src=n.banner);const e=document.querySelector(".profile-credits");e&&(e.textContent=`Credits: ${n.credits}`);const o=document.querySelector(".profile-listings-count");o&&(o.textContent=`Listings: ${n.listingsCount}`);const m=document.querySelector(".profile-wins-count");m&&(m.textContent=`Wins: ${n.winsCount}`)}function me(){if(!document.body.classList.contains("homepage"))return;const n=document.getElementById("carousel"),i=document.getElementById("prev-button"),s=document.getElementById("next-button"),r=document.getElementById("dots-container");async function t(){try{const o=await fetch("https://v2.api.noroff.dev/auction/listings?_bids=true",{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("Failed to fetch listings");return(await o.json()).data.filter(g=>g.bids&&g.bids.length>0&&new Date(g.endsAt)>new Date).sort((g,a)=>Math.max(...a.bids.map(u=>u.amount))-Math.max(...g.bids.map(u=>u.amount))).slice(0,3)}catch(o){return console.error("Error fetching highest bid listings:",o),[]}}async function e(){const o=await t();if(o.length===0){console.error("No active listings with bids available.");return}n.classList.add("flex","transition-transform","duration-500","ease-in-out");const m=(h,l)=>h?h.length>l?h.slice(0,l)+"...":h:"";o.forEach(h=>{const l=Math.max(...h.bids.map(p=>p.amount)),d=h.media&&h.media[0]&&h.media[0].url?h.media[0].url:"default-image.jpg",c=document.createElement("div");c.classList.add("carousel-slide","relative","w-full","h-[500px]","shrink-0","flex","items-center","justify-center"),c.innerHTML=`
                <div class="absolute inset-0">
                    <img src="${d}" alt="${h.title}" class="w-full h-full object-cover break-words truncate">
                </div>
                <div class="absolute inset-0 bg-black bg-opacity-50 flex flex-col justify-center items-center text-white p-4">
                    <h3 class="text-3xl font-bold mb-4 break-words truncate">${m(h.title,20)}</h3>
                    <p class="text-xl mb-2"><strong>Highest Bid:</strong> ${l} ðŸŒ•</p>
                    <p class="text-xl mb-4"><strong>Ends in:</strong> ${pe(h.endsAt)}</p>
                    <a href="/listing/view/index.html?id=${h.id}" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded">View Listing</a>
                </div>
            `,n.appendChild(c)}),o.forEach((h,l)=>{const d=document.createElement("div");d.classList.add("dot","w-3","h-3","bg-gray-400","rounded-full","cursor-pointer","mx-1"),d.addEventListener("click",()=>{g=l,u()}),r.appendChild(d)});let g=0;const a=o.length;function u(){const h=-g*100;n.style.transform=`translateX(${h}%)`,document.querySelectorAll(".dot").forEach((d,c)=>{c===g?(d.classList.add("bg-white","scale-125"),d.classList.remove("bg-gray-400","scale-100")):(d.classList.add("bg-gray-400","scale-100"),d.classList.remove("bg-white","scale-125"))})}function f(){g=(g+1)%a,u()}function y(){g=(g-1+a)%a,u()}s.addEventListener("click",f),i.addEventListener("click",y),u()}e()}function pe(n){const r=new Date(n)-new Date;if(r>0){const t=Math.floor(r/864e5),e=Math.floor(r%(1e3*60*60*24)/(1e3*60*60)),o=Math.floor(r%(1e3*60*60)/(1e3*60));return t>0?`${t} day${t>1?"s":""}`:e>0?`${e} hour${e>1?"s":""}`:`${o} minute${o>1?"s":""}`}else return"Ended"}async function F(n,i=9){if(!document.body.classList.contains("homepage"))return;let s=1,r=[];const t=document.getElementById("listings-container"),e=document.getElementById("pagination-container"),o=document.getElementById("tag-filter"),m=document.querySelectorAll(".search-input");async function g(l,d=100){let c=[],p=1,w=!0;for(;w;)try{const b=await fetch(`${l}?_seller=true&_bids=true&limit=${d}&page=${p}`);if(!b.ok)throw new Error(`Failed to fetch listings: ${b.status}`);const v=await b.json();if(c=c.concat(v.data||[]),w=(v.data||[]).length===d,p++,c.length>=1e3)break}catch(b){console.error("Error fetching listings:",b),w=!1}return c}const a=await g(n);r=a.filter(l=>{const d=l.endsAt?new Date(l.endsAt):null;return d&&d>new Date});function u(l){const d=(l-1)*i,c=d+i,p=r.slice(d,c);t.innerHTML="",p.forEach(w=>{var L,k,$,C;const b=document.createElement("div");b.classList.add("flex","flex-col","p-4","bg-white","w-[320px]","rounded","shadow-md","h-auto");const v=((k=(L=w.media)==null?void 0:L[0])==null?void 0:k.url)||"../../assets/placeholders/placeholder-pen-02.png",I=($=w.bids)!=null&&$.length?Math.max(...w.bids.map(B=>B.amount)):"0",x=w.endsAt;let E="N/A";if(x){const T=new Date(x)-new Date;if(T>0){const P=Math.floor(T/864e5),q=Math.floor(T%(1e3*60*60*24)/(1e3*60*60)),H=Math.floor(T%(1e3*60*60)/(1e3*60));P>0?E=`${P} day${P>1?"s":""}`:q>0?E=`${q} hour${q>1?"s":""}`:E=`${H} minute${H>1?"s":""}`}else E="Ended"}const S=(B,A)=>B?B.length>A?B.slice(0,A)+"...":B:"";b.innerHTML=`
                <img src="${v}" alt="${w.title}" class="mb-4 rounded h-[250px] object-cover">
                <h3 class="text-blue-950 font-bold text-lg break-words truncate">${w.title}</h3>
                <div>
                    <span class="text-blue-950 font-bold">Current Bid:</span>
                    <span>${I} ðŸŒ•</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Description:</span>
                    <span class="italic break-words">${S(w.description,30)}</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Ends in:</span>
                    <span>${E}</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Seller:</span>
                    <span>${((C=w.seller)==null?void 0:C.name)||"Unknown"}</span>
                </div>
                <a href="/listing/view/index.html?id=${w.id}" class="mt-4 bg-blue-950 hover:bg-orange-600 text-white py-2 px-4 rounded text-center">View Listing</a>
            `,t.appendChild(b)})}function f(){e.innerHTML="";const l=Math.ceil(r.length/i),d=5,c=(v,I,x=!1)=>{const E=document.createElement("button");return E.textContent=v,E.classList.add("px-3","py-1","border","rounded","mx-1","bg-orange-500","hover:bg-orange-700","text-white"),x&&E.classList.add("bg-orange-600","text-white"),E.addEventListener("click",()=>{s=I,u(s),f()}),E};s>1&&(e.appendChild(c("1",1)),e.appendChild(c("Previous",s-1)));const p=Math.max(1,s-Math.floor(d/2)),w=Math.min(l,p+d-1),b=Math.max(1,w-d+1);for(let v=b;v<=w;v++)e.appendChild(c(v,v,v===s));s<l&&(e.appendChild(c("Next",s+1)),e.appendChild(c(l,l)))}function y(){const l=Array.from(m).map(c=>c.value.toLowerCase()).join(" ").trim(),d=(o==null?void 0:o.value)||"";r=a.filter(c=>{var I,x,E,S,L,k,$,C,B,A;const p=c.endsAt?new Date(c.endsAt):null,w=p&&p>new Date,b=(!d||((I=c.tags)==null?void 0:I.includes(d)))&&w,v=!l||((x=c.title)==null?void 0:x.toLowerCase().includes(l))||((E=c.description)==null?void 0:E.toLowerCase().includes(l))||((k=(L=(S=c.media)==null?void 0:S[0])==null?void 0:L.alt)==null?void 0:k.toLowerCase().includes(l))||(($=c.tags)==null?void 0:$.some(T=>T.toLowerCase().includes(l)))||((B=(C=c.seller)==null?void 0:C.name)==null?void 0:B.toLowerCase().includes(l))||((A=c.id)==null?void 0:A.toLowerCase().includes(l));return b&&v}),s=1,u(s),f()}function h(){if(!o)return;const l=new Set;a.forEach(d=>{const c=d.endsAt?new Date(d.endsAt):null;c&&c>new Date&&d.tags&&d.tags.forEach(w=>l.add(w))}),o.innerHTML='<option value="">All Tags</option>',l.forEach(d=>{const c=document.createElement("option");c.value=d,c.textContent=d,o.appendChild(c)})}o&&o.addEventListener("change",y),m.length>0&&m.forEach(l=>l.addEventListener("input",y)),h(),u(s),f()}async function _(n){const i=document.getElementById("search-input"),s=document.querySelector("main");if(!i||!s){console.error("Search input or main element not found.");return}async function r(e,o=100){let m=[],g=1,a=!0;for(;a;)try{const u=await fetch(`${e}?_seller=true&_bids=true&limit=${o}&page=${g}`);if(!u.ok)throw new Error(`Failed to fetch listings: ${u.status}`);const f=await u.json();if(m=m.concat(f.data||[]),a=(f.data||[]).length===o,g++,m.length>=1e3)break}catch(u){console.error("Error fetching listings:",u),a=!1}return console.log("Fetched Listings for Search:",m),m}async function t(e){console.log("Search Query:",e);const m=(await r(n)).filter(a=>{var c,p,w,b,v,I;const u=(c=a.title)==null?void 0:c.toLowerCase().includes(e),f=(p=a.description)==null?void 0:p.toLowerCase().includes(e),y=(v=(b=(w=a.media)==null?void 0:w[0])==null?void 0:b.alt)==null?void 0:v.toLowerCase().includes(e),h=(I=a.tags)==null?void 0:I.some(x=>x.toLowerCase().includes(e)),l=a.endsAt?new Date(a.endsAt):null,d=l&&l>new Date;return(u||f||y||h)&&d});if(console.log("Filtered Results:",m),s.innerHTML="",m.length===0){s.innerHTML=`
                <div class="text-center py-8">
                    <h2 class="text-xl font-bold">No results found</h2>
                    <p>Try adjusting your search query.</p>
                </div>
            `;return}const g=document.createElement("div");g.classList.add("flex","flex-wrap","gap-4","justify-center","p-4","items-center","mx-auto","bg-gray-100"),m.forEach(a=>{var c,p,w,b;const u=document.createElement("div");u.classList.add("flex","flex-col","p-4","bg-white","w-[320px]","rounded","shadow-md","h-auto");const f=((p=(c=a.media)==null?void 0:c[0])==null?void 0:p.url)||"../../assets/placeholders/placeholder-pen-02.png",y=(w=a.bids)!=null&&w.length?Math.max(...a.bids.map(v=>v.amount)):"0",h=a.endsAt;let l="N/A";if(h){const x=new Date(h)-new Date;if(x>0){const E=Math.floor(x/864e5),S=Math.floor(x%(1e3*60*60*24)/(1e3*60*60)),L=Math.floor(x%(1e3*60*60)/(1e3*60));E>0?l=`${E} day${E>1?"s":""}`:S>0?l=`${S} hour${S>1?"s":""}`:l=`${L} minute${L>1?"s":""}`}else l="Ended"}const d=(v,I)=>v?v.length>I?v.slice(0,I)+"...":v:"";u.innerHTML=`
                <img src="${f}" alt="${a.title}" class="mb-4 rounded h-[250px] object-cover">
                <h3 class="text-blue-950 font-bold text-lg break-words truncate">${a.title}</h3>
                <div>
                    <span class="text-blue-950 font-bold">Current Bid:</span>
                    <span>${y} ðŸŒ•</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Description:</span>
                    <span class="italic break-words">${d(a.description,30)}</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Ends in:</span>
                    <span>${l}</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Seller:</span>
                    <span>${((b=a.seller)==null?void 0:b.name)||"Unknown"}</span>
                </div>
                <a href="/listing/view/index.html?id=${a.id}" class="mt-4 bg-blue-950 text-white py-2 px-4 rounded text-center">View Listing</a>
            `,g.appendChild(u)}),s.appendChild(g)}i.addEventListener("input",()=>{const e=i.value.toLowerCase();t(e)})}async function fe(){var r,t,e,o,m,g,a,u,f;if(!document.body.classList.contains("view-single-listing-page")||!U())return;const i=new URLSearchParams(window.location.search).get("id");if(!i){console.error("No listing ID found in URL");return}const s=`https://v2.api.noroff.dev/auction/listings/${i}?_seller=true&_bids=true`;try{const y=localStorage.getItem("token");if(!y){console.error("No token found. User may not be logged in.");return}const h=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`}});if(!h.ok)throw new Error("Failed to fetch listing");const{data:l}=await h.json();document.querySelector(".view-single-listing-title").textContent=l.title||"No title available",document.querySelector(".view-single-listing-description").textContent=l.description||"No description available",document.querySelector(".single-listing-tags").textContent=((r=l.tags)==null?void 0:r.join(", "))||"No tags available";const d=document.querySelector(".view-single-listing-carousel"),c=document.querySelector(".view-single-listing-image-alt-text"),p=l.media||[];if(p.length>0){let I=0;const x=()=>{var $,C;const E=document.querySelector(".view-single-listing-image"),S=document.querySelector(".view-single-listing-image-alt-text");E.src=(($=p[I])==null?void 0:$.url)||"../../assets/placeholders/placeholder-pen.png",S.textContent=((C=p[I])==null?void 0:C.alt)||"No image description available";const L=document.getElementById("carousel-left-button"),k=document.getElementById("carousel-right-button");p.length===1?(L.style.display="none",k.style.display="none"):(L.style.display="inline-block",k.style.display="inline-block"),L.disabled=I<=0,k.disabled=I>=p.length-1};d.innerHTML=`
                <div class="carousel-image-container">
                    <img src="${p[0].url}" alt="${p[0].alt}" class="view-single-listing-image w-full h-[500px] object-cover">
                </div>
                <div class="view-single-listing-image-alt-text text-center italic text-blue-950 text-xs">${p[0].alt}</div>
                <div class="carousel-controls flex justify-center gap-4 mt-2">
                    <button id="carousel-left-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">â—€</button>
                    <button id="carousel-right-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">â–¶</button>
                </div>
            `,document.getElementById("carousel-left-button").addEventListener("click",()=>{I>0&&(I--,x())}),document.getElementById("carousel-right-button").addEventListener("click",()=>{I<p.length-1&&(I++,x())}),x()}else d.innerHTML=`
                <img src="../../assets/placeholders/placeholder-pen.png" alt="No image available" class="view-single-listing-image w-full h-[500px] object-cover">
                <div class="view-single-listing-image-alt-text text-center italic text-blue-950 text-xs">No image alt text available</div>
            `;document.querySelector(".view-single-listing-seller-avatar").src=((e=(t=l.seller)==null?void 0:t.avatar)==null?void 0:e.url)||"../../assets/placeholders/avatar-placeholder.png",document.querySelector(".view-single-listing-seller-name").textContent=((o=l.seller)==null?void 0:o.name)||"Unknown Seller";const w=(m=l.bids)!=null&&m.length?Math.max(...l.bids.map(I=>I.amount)):"0";document.querySelector(".highest-bid-on-single-listing").textContent=`${w} ðŸŒ•`;const b=(g=l.bids)!=null&&g.length?(u=(a=l.bids[l.bids.length-1])==null?void 0:a.bidder)==null?void 0:u.name:"No bids yet";document.querySelector(".higest-bidder-dame").textContent=b;const v=document.querySelector(".bid-history-table");v&&((f=l.bids)!=null&&f.length)&&(v.innerHTML="",[...l.bids].sort((x,E)=>new Date(E.created)-new Date(x.created)).forEach(x=>{var S,L,k;const E=document.createElement("div");E.classList.add("bid-history-table","bg-white","flex","justify-between","p-4","m-4","items-center","text-blue-950","w-full"),E.innerHTML=`
                    <div>
                        <img src="${((L=(S=x.bidder)==null?void 0:S.avatar)==null?void 0:L.url)||"../../assets/placeholders/avatar-placeholder.png"}" alt="avatar"
                        class="bid-history-avatar w-[50px] h-[50px] object-cover mx-auto rounded-full overflow-hidden">
                    </div>
                    <div class="bid-history-username font-bold">${((k=x.bidder)==null?void 0:k.name)||"Anonymous"}</div>
                    <div class="bid-history-date">${new Date(x.created).toLocaleDateString()}</div>
                    <div class="bid-history-amount-of-bid font-bold">${x.amount} ðŸŒ•</div>
                `,v.appendChild(E)}))}catch(y){console.error("Error fetching single listing:",y)}}function he(){if(!document.body.classList.contains("view-single-listing-page"))return;const n=document.querySelector(".copy-link-to-listing");if(!n){console.error("Copy link element not found in the DOM.");return}n.addEventListener("click",()=>{const i=window.location.href;navigator.clipboard.writeText(i).then(()=>{alert("Successfully copied the link to this listing")}).catch(s=>{console.error("Failed to copy the link:",s),alert("Failed to copy the link. Please try again.")})})}function ye(){if(!document.body.classList.contains("view-single-listing-page"))return;const n=document.getElementById("place-bid-button"),i=document.getElementById("place-bid");if(!n||!i){console.error("Bid button or input field not found.");return}n.addEventListener("click",async s=>{s.preventDefault();const r=parseFloat(i.value);if(isNaN(r)||r<=0){alert("Please enter a valid bid amount.");return}const e=new URLSearchParams(window.location.search).get("id");if(!e){console.error("Listing ID not found in the URL."),alert("Could not determine the listing to place a bid.");return}const o=localStorage.getItem("api_key"),m=localStorage.getItem("token");if(!o||!m){console.error("API key or access token not found in localStorage."),alert("Unable to authenticate. Please log in again.");return}const g={method:"POST",headers:{"X-Noroff-API-Key":o,"Content-Type":"application/json",Authorization:`Bearer ${m}`},body:JSON.stringify({amount:r})};try{console.log(`Placing bid on listing ${e} with amount ${r}`);const a=await fetch(`https://v2.api.noroff.dev/auction/listings/${e}/bids`,g);if(!a.ok){const f=await a.json();console.error("Error response from API:",f),alert(`Error placing bid: ${f.message||"An unexpected error occurred."}`);return}const u=await a.json();console.log("Bid placed successfully:",u),alert("Bid placed successfully!"),location.reload()}catch(a){console.error("Error placing bid:",a),alert("An error occurred while placing your bid. Please try again later.")}})}function we(){if(!document.body.classList.contains("my-account-page"))return;const n=localStorage.getItem("token"),i=localStorage.getItem("api_key"),s=localStorage.getItem("username"),r=n.replace(/['"]+/g,""),t=s.replace(/['"]+/g,"");fetch(`https://v2.api.noroff.dev/auction/profiles/${t}?_wins=true`,{method:"GET",headers:{"X-Noroff-API-Key":i,Authorization:`Bearer ${r}`,"Content-Type":"application/json"}}).then(e=>{if(e.ok)return e.json();throw new Error("Failed to fetch user wins")}).then(e=>{var g;const o=((g=e==null?void 0:e.data)==null?void 0:g.wins)||[];if(o.length===0){console.log("No won listings found.");return}const m=document.getElementById("user-wins-container");if(!m){console.error("User wins container not found in the DOM");return}m.innerHTML="",o.forEach(a=>{var y,h,l;const u=document.createElement("div");u.classList.add("flex","flex-col","p-4","bg-white","w-[320px]","rounded","shadow-md","h-auto");const f=((h=(y=a.media)==null?void 0:y[0])==null?void 0:h.url)||"../../assets/placeholders/placeholder-pen-02.png";u.innerHTML=`
                    <a href="/listing/view/index.html?id=${a.id}" class="block">
                        <img src="${f}" alt="${a.title}" class="mb-4 rounded h-[250px] object-cover">
                        <h3 class="text-blue-950 font-bold text-lg break-words truncate">${a.title}</h3>
                        <div>
                            <span class="text-blue-950 font-bold">Description:</span>
                            <span class="italic break-words">${a.description||"No description available"}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Category:</span>
                            <span>${((l=a.tags)==null?void 0:l.join(", "))||"N/A"}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Ended At:</span>
                            <span>${new Date(a.endsAt).toLocaleDateString()||"Unknown"}</span>
                        </div>
                    </a>
                `,m.appendChild(u)})}).catch(e=>{console.error("Error fetching user wins:",e)})}function ve(){if(!document.body.classList.contains("create-listing-page"))return;const n=document.getElementById("new-listing-title"),i=document.getElementById("new-listing-description"),s=document.getElementById("new-listing-category"),r=[document.getElementById("new-listing-image-1"),document.getElementById("new-listing-image-2"),document.getElementById("new-listing-image-3")],t=[document.getElementById("new-listing-image-alt-1"),document.getElementById("new-listing-image-alt-2"),document.getElementById("new-listing-image-alt-3")],e=document.querySelector(".review-new-listing-title"),o=document.querySelector(".review-new-listing-description"),m=document.querySelector(".review-new-listing-tags"),g=document.querySelector(".review-new-listing-image"),a=document.querySelector(".review-new-listing-image-alt-text"),u=document.createElement("button"),f=document.createElement("button");u.textContent="â—€",f.textContent="â–¶";let y=0;const h=()=>{var w,b;const c=r.filter(v=>v.value),p=c.length;p>0?(y=Math.min(y,p-1),g.src=((w=c[y])==null?void 0:w.value)||"../../assets/placeholders/placeholder-pen.png",a.textContent=((b=t[y])==null?void 0:b.value)||"Image alt text goes here"):(g.src="../../assets/placeholders/placeholder-pen.png",a.textContent="Image alt text goes here"),u.disabled=y<=0,f.disabled=y>=p-1},l=()=>{e.textContent=n.value||"Listing title",o.textContent=i.value||"Lorem ipsum description goes here...",m.textContent=s.value||"Category",h()};u.addEventListener("click",()=>{y>0&&(y--,h())}),f.addEventListener("click",()=>{const c=r.filter(p=>p.value).length;y<c-1&&(y++,h())}),n.addEventListener("input",l),i.addEventListener("input",l),s.addEventListener("input",l),r.forEach(c=>c.addEventListener("input",h)),t.forEach(c=>c.addEventListener("input",h));const d=document.querySelector(".review-new-listing-carousel");d.appendChild(u),d.appendChild(f),l()}async function be(){var d;if(!document.body.classList.contains("edit-listing-page"))return;const n=localStorage.getItem("token");localStorage.getItem("api_key");const s=new URLSearchParams(window.location.search).get("id");if(!s){console.error("No listing ID found in URL.");return}const r=`https://v2.api.noroff.dev/auction/listings/${s}?_seller=true&_bids=true`,t=document.getElementById("edit-listing-title"),e=document.getElementById("edit-listing-description"),o=document.getElementById("edit-listing-category"),m=[document.getElementById("edit-listing-image-1"),document.getElementById("edit-listing-image-2"),document.getElementById("edit-listing-image-3")],g=[document.getElementById("edit-listing-image-alt-1"),document.getElementById("edit-listing-image-alt-2"),document.getElementById("edit-listing-image-alt-3")],a=document.querySelector(".view-edit-listing-title"),u=document.querySelector(".view-edit-listing-description"),f=document.querySelector(".edit-listing-tags"),y=document.querySelector(".view-edit-listing-image"),h=document.querySelector(".view-edit-listing-image-alt-text"),l=()=>{var w,b;a.textContent=t.value||"Listing title",u.textContent=e.value||"Lorem ipsum description goes here...",f.textContent=o.value||"Category";const c=((w=m[0])==null?void 0:w.value)||"../../assets/placeholders/placeholder-pen.png",p=((b=g[0])==null?void 0:b.value)||"Image alt text goes here";y.src=c,h.textContent=p};try{const c=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!c.ok)throw new Error("Failed to fetch listing details.");const p=await c.json();t.value=p.title||"",e.value=p.description||"",o.value=((d=p.tags)==null?void 0:d.join(", "))||"",(p.media||[]).forEach((b,v)=>{m[v]&&(m[v].value=b.url||"",g[v].value=b.alt||"")}),l()}catch(c){console.error("Error fetching listing details:",c)}t.addEventListener("input",l),e.addEventListener("input",l),o.addEventListener("input",l),m.forEach((c,p)=>{var w;c.addEventListener("input",l),(w=g[p])==null||w.addEventListener("input",l)})}async function X(){var t;if(!document.body.classList.contains("edit-listing-page")||!U())return;const n=localStorage.getItem("token");if(!n)return;const s=new URLSearchParams(window.location.search).get("id");if(!s)return;const r=`https://v2.api.noroff.dev/auction/listings/${s}?_seller=true&_bids=true`;try{const e=await fetch(r,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!e.ok)throw new Error(`Failed to fetch listing. Status: ${e.status}`);const{data:o}=await e.json();Ee(o);const m=((t=o.bids)==null?void 0:t.length)>0?Math.max(...o.bids.map(a=>a.amount)):"0",g=document.querySelector(".highest-bid-on-edit-listing");g?g.textContent=`${m} ðŸŒ•`:console.warn("Highest bid element not found in the DOM."),J(o.media)}catch(e){console.error("Error fetching or populating listing data:",e)}}function Ee(n){var i,s;document.getElementById("edit-listing-title").value=n.title||"",document.getElementById("edit-listing-description").value=n.description||"",document.getElementById("edit-listing-category").value=((i=n.tags)==null?void 0:i.join(", "))||"",(s=n.media)==null||s.forEach((r,t)=>{const e=document.getElementById(`edit-listing-image-${t+1}`),o=document.getElementById(`edit-listing-image-alt-${t+1}`);e&&(e.value=r.url||""),o&&(o.value=r.alt||"")})}function J(n=[]){var e,o,m;const i=document.getElementById("edit-listing-title").value||"No title available",s=document.getElementById("edit-listing-description").value||"No description available",r=document.getElementById("edit-listing-category").value||"No category available";document.querySelector(".view-edit-listing-title").textContent=i,document.querySelector(".view-edit-listing-description").textContent=s,document.querySelector(".edit-listing-tags").textContent=r;const t=document.querySelector(".view-edit-listing-carousel");if(!t){console.error("Carousel container not found.");return}if(n.length>0){let g=0;const a=()=>{var l,d;const u=document.querySelector(".view-edit-listing-image"),f=document.querySelector(".view-edit-listing-image-alt-text");u.src=((l=n[g])==null?void 0:l.url)||"../../assets/placeholders/placeholder-pen.png",f.textContent=((d=n[g])==null?void 0:d.alt)||"No description available";const y=document.getElementById("carousel-left-button"),h=document.getElementById("carousel-right-button");n.length===1?(y.style.display="none",h.style.display="none"):(y.style.display="inline-block",h.style.display="inline-block"),y.disabled=g<=0,h.disabled=g>=n.length-1};t.innerHTML=`
            <div class="carousel-image-container">
                <img src="${(e=n[0])==null?void 0:e.url}" alt="${(o=n[0])==null?void 0:o.alt}" class="view-edit-listing-image w-full h-[500px] object-cover">
            </div>
            <div class="view-edit-listing-image-alt-text text-center italic text-blue-950 text-xs">${((m=n[0])==null?void 0:m.alt)||"No description available"}</div>
            <div class="carousel-controls flex justify-center gap-4 mt-2">
                <button id="carousel-left-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">â—€</button>
                <button id="carousel-right-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">â–¶</button>
            </div>
        `,document.getElementById("carousel-left-button").addEventListener("click",()=>{g>0&&(g--,a())}),document.getElementById("carousel-right-button").addEventListener("click",()=>{g<n.length-1&&(g++,a())}),a()}else t.innerHTML=`
            <img src="../../assets/placeholders/placeholder-pen.png" alt="No image available" class="view-edit-listing-image w-full h-[500px] object-cover">
            <div class="view-edit-listing-image-alt-text text-center italic text-blue-950 text-xs">No image alt text available</div>
        `}document.addEventListener("DOMContentLoaded",()=>{X(),["edit-listing-title","edit-listing-description","edit-listing-category","edit-listing-image-1","edit-listing-image-alt-1"].forEach(n=>{const i=document.getElementById(n);i&&i.addEventListener("input",()=>J())})});async function M(n){if(!document.body.classList.contains("edit-listing-page"))return;n.preventDefault();const i=localStorage.getItem("token");if(!i){console.error("No token found. User may not be logged in.");return}const r=new URLSearchParams(window.location.search).get("id");if(!r){console.error("No listing ID found in the URL.");return}const t=`https://v2.api.noroff.dev/auction/listings/${r}`,e=document.getElementById("edit-listing-title").value,o=document.getElementById("edit-listing-description").value,m=document.getElementById("edit-listing-category").value.split(",").map(f=>f.trim()).filter(f=>f),g=[];for(let f=1;f<=3;f++){const y=document.getElementById(`edit-listing-image-${f}`).value,h=document.getElementById(`edit-listing-image-alt-${f}`).value;y&&g.push({url:y,alt:h||"No description available"})}const a={title:e,description:o,tags:m,media:g},u=localStorage.getItem("api_key");try{const f=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`,"X-Noroff-API-Key":u},body:JSON.stringify(a)});if(!f.ok)throw new Error(`Failed to save listing. Status: ${f.status}`);alert("Listing successfully updated!"),window.location.href=`../../listing/view/index.html?id=${r}`}catch(f){console.error("Error saving listing:",f),alert("Failed to save the listing. Please try again.")}}function Ie(){const n=document.getElementById("edit-listing-button");n&&n.addEventListener("click",M)}function xe(){const i="pageRefreshCount";let s=parseInt(localStorage.getItem(i))||0;s<1?(localStorage.setItem(i,s+1),location.reload()):localStorage.removeItem(i)}document.addEventListener("DOMContentLoaded",async function(){xe(),le(),ce(),me(),fe(),he(),ye(),de(),we(),ve(),be(),X(),M(),Ie();try{const t=await fetch("https://v2.api.noroff.dev/auction/listings?_bids=true",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch listings");const o=(await t.json()).data||[];F(o),F("https://v2.api.noroff.dev/auction/listings"),_(o),_("https://v2.api.noroff.dev/auction/listings")}catch(t){console.error("Error fetching listings:",t)}const n=await ue();n&&ge(n);const i=localStorage.getItem("username");if(i){const t=i.replace(/['"]+/g,""),e=document.querySelector(".logged-in-username");e&&(e.textContent="Hello, "+t+"! You are currently logged in.");const o=document.querySelector(".visible-if-logged-in");o&&(o.style.display="block")}const s=document.getElementById("edit-listing-button");s&&s.addEventListener("click",M);const r=document.querySelectorAll(".delete-listing-button");r.length,r.forEach(t=>{const e=t.getAttribute("data-listing-id"),o=t.closest(".listing-card");if(!e||!o){console.error("Missing listing ID or listing card for delete button.");return}console.log(`Attaching delete listener to listing ID: ${e}`),t.addEventListener("click",()=>{G(e,o)})})});
