(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const o of e.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(t){if(t.ep)return;t.ep=!0;const e=s(t);fetch(t.href,e)}})();function D(n){const r=n.currentTarget,s=r.previousElementSibling;console.log("Show Password Button Clicked:",r),console.log("Password Input Element:",s),s?s.type==="password"?(s.type="text",r.querySelector(".fa-eye-slash").classList.remove("hide"),r.querySelector(".fa-eye").classList.add("hide")):(s.type="password",r.querySelector(".fa-eye-slash").classList.add("hide"),r.querySelector(".fa-eye").classList.remove("hide")):console.error("Password input not found.")}const V="https://v2.api.noroff.dev",_=`${V}/auth`,Y=`${_}/login`,W=`${_}/register`,R=()=>{const n=document.getElementById("login-email"),r=document.getElementById("login-password"),s=document.querySelector(".show-password"),i=document.getElementById("login-error"),t=document.getElementById("login-btn");return{email:n,password:r,showPasswordBtn:s,errorMessage:i,loginBtn:t}},O=()=>{const n=document.getElementById("username"),r=document.getElementById("register-email"),s=document.getElementById("register-password"),i=document.querySelector(".show-password"),t=document.getElementById("error-message"),e=document.getElementById("success-message"),o=document.getElementById("register-btn");return{username:n,email:r,password:s,showPasswordBtn:i,errorMessage:t,successMessage:e,registerBtn:o}};function Q(){const{username:n,email:r,password:s,showPasswordBtn:i,errorMessage:t,successMessage:e,registerBtn:o}=O();if(!i||!s){console.error("Required elements for show-password functionality are missing.");return}i.addEventListener("click",D),o.addEventListener("click",async function(g){if(g.preventDefault(),t.style.display="none",e.style.display="none",n.value.length<2||r.value.length<2||s.value.length<2){t.style.display="block",t.innerHTML="All fields must be filled in.",console.log("All fields must be filled in.");return}if(s.value.length<9){t.innerHTML="The password must contain more than 9 characters.",t.style.display="block",console.log("The password must contain more than 9 characters.");return}if(s.value.length>20){t.innerHTML="The password must contain less than 20 characters.",t.style.display="block",console.log("The password must contain less than 20 characters.");return}if(!r.value.includes("@stud.noroff.no")){t.innerHTML="The email must end with @stud.noroff.no.",t.style.display="block",console.log("The email must end with @stud.noroff.no.");return}if(!/^[a-zA-Z0-9]+$/.test(n.value)){t.innerHTML="The username must only contain letters and numbers.",t.style.display="block",console.log("The username must only contain letters and numbers.");return}const f={name:n.value,email:r.value,bio:"Default bio",avatar:{url:"https://github.com/elanetto/FED1-PE1-elanetto/blob/main/assets/images/user/avatar-user-default.png?raw=true",alt:"User  Avatar"},banner:{url:"https://github.com/elanetto/FED1-PE1-elanetto/blob/main/assets/images/200kb-images/kewater_view-01.jpg?raw=true",alt:"User  Banner"},venueManager:!0,password:s.value};try{const a=await fetch(W,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(f)}),d=await a.json();if(console.log(d),d.errors){console.log(d.errors),t.style.display="block",t.innerHTML=d.errors.map(p=>p.message).join("<br>"),console.log(d.errors);return}a.ok&&(e.style.display="block",console.log("User registered successfully."),alert("User registered successfully. You will be redirected to the login page."),setTimeout(()=>{window.location.href="../login/"},2e3))}catch(a){console.log(a),t.style.display="block",t.innerHTML="Something went wrong. Please try again."}document.querySelector(".register-form").reset()})}async function K(){const n=localStorage.getItem("token"),r=localStorage.getItem("username"),s=localStorage.getItem("api_key");if(!n||!r||!s)return console.error("Missing authentication data."),null;const i=new Headers;i.append("Authorization",`Bearer ${n}`),i.append("X-Noroff-API-Key",s);try{const t=await fetch(`https://v2.api.noroff.dev/auction/profiles/${r}`,{method:"GET",headers:i});if(!t.ok)throw new Error(`Failed to fetch profile data: ${t.status}`);const e=await t.json();localStorage.setItem("credits",e.data.credits),localStorage.setItem("listingsCount",e.data._count.listings),localStorage.setItem("winsCount",e.data._count.wins);const o=document.querySelector(".my-credits");return o&&(o.textContent=e.data.credits),e.data}catch(t){return console.error("Error fetching profile data:",t),null}}function Z(){const{email:n,password:r,showPasswordBtn:s,errorMessage:i,loginBtn:t}=R();if(!n||!t||!i||!r||!s)return;const e=s.querySelector(".fa-eye-slash"),o=s.querySelector(".fa-eye");if(!e||!o)return;function g(){r.type==="password"?(e.classList.add("hide"),o.classList.remove("hide")):(e.classList.remove("hide"),o.classList.add("hide"))}g(),s.removeEventListener("click",D),s.addEventListener("click",D),t.addEventListener("click",async function(f){var y,h;f.preventDefault();const a=n.value.trim(),d=r.value.trim();if(!ee(a)){i.textContent="Email not valid",i.style.display="block";return}if(d.length===0){i.textContent="Please enter a password",i.style.display="block";return}const p={email:a,password:d};try{const l=await fetch(Y,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(p)}),m=await l.json();if(l.ok){localStorage.setItem("username",m.data.name),localStorage.setItem("email",m.data.email),localStorage.setItem("avatar",m.data.avatar.url),localStorage.setItem("banner",m.data.banner.url),localStorage.setItem("token",m.data.accessToken),localStorage.setItem("bio",m.data.bio);let c=3,u=!1;for(;c>0&&!u;){if(await K()){u=!0;break}console.log(`Retrying fetchProfileData... (${3-c+1})`),await new Promise(b=>setTimeout(b,1e3)),c--}if(!u){i.textContent="Failed to load profile data. Please refresh the page.",i.style.display="block";return}window.location.href="../../account/myaccount/"}else{const c=((h=(y=m.errors)==null?void 0:y[0])==null?void 0:h.message)||"An error occurred during login.";i.textContent=c,i.style.display="block"}}catch(l){console.error("Error during login:",l),i.textContent="An error occurred with your login request.",i.style.display="block"}})}function ee(n){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(n)}function te(){const n=localStorage.getItem("username"),r=localStorage.getItem("email"),s=localStorage.getItem("avatar"),i=localStorage.getItem("banner"),t=localStorage.getItem("credits"),e=localStorage.getItem("listingsCount"),o=localStorage.getItem("winsCount"),g=localStorage.getItem("bio");document.querySelectorAll(".username-from-local-storage").forEach(u=>{n&&(u.textContent=n)}),document.querySelectorAll(".email-from-local-storage").forEach(u=>{r&&(u.textContent=r)});const d=document.querySelector(".avatar-from-local-storage");s&&d&&(d.src=s),document.querySelectorAll(".my-avatar").forEach(u=>{s&&(u.src=s)});const y=document.querySelector(".banner-from-local-storage");i&&y&&(y.src=i),document.querySelectorAll(".my-credits").forEach(u=>{u.innerText=t}),document.querySelectorAll(".my-listings-count").forEach(u=>{u.innerText=e}),document.querySelectorAll(".my-wins-count").forEach(u=>{u.innerText=o}),document.querySelectorAll(".my-bio").forEach(u=>{u.innerText=g})}function N(){const n=localStorage.getItem("token");if(!n){console.error("No token found");return}const r=n.replace(/['"]+/g,""),s=new Headers;return s.append("Authorization",`Bearer ${r}`),fetch("https://v2.api.noroff.dev/auth/create-api-key",{method:"POST",headers:s,redirect:"follow"}).then(t=>{if(!t.ok)throw new Error(`API key request failed: ${t.status} ${t.statusText}`);return t.json()}).then(t=>{var o;const e=(o=t==null?void 0:t.data)==null?void 0:o.key;if(!e)throw new Error("API key not found in response");return localStorage.setItem("api_key",e),e}).catch(t=>(console.error("Error fetching API key:",t),null))}function j(){const n=localStorage.getItem("token"),r=localStorage.getItem("username");if(!n)return null;const s=n.replace(/['"]+/g,"");if(!r)return null;const i=r.replace(/['"]+/g,"");return{cleanedToken:s,cleanedUsername:i}}function ne(){const n=j();if(!n){console.warn("Token details are not available. Skipping profile picture setup.");return}const{cleanedToken:r,cleanedUsername:s}=n,i=document.getElementById("avatar-input"),t=document.getElementById("change-avatar-button");if(!i||!t){console.warn("Profile picture input or button not found. Skipping setup.");return}t.addEventListener("click",async e=>{e.preventDefault();const o=i.value.trim();if(!o||!oe(o)){alert("Please enter a valid URL.");return}try{const g=await N();if(!g){alert("Unable to fetch API key.");return}const f=new Headers;f.append("Content-Type","application/json"),f.append("X-Noroff-API-Key",g),f.append("Authorization",`Bearer ${r}`);const a=JSON.stringify({avatar:{url:o,alt:"Avatar"}}),d={method:"PUT",headers:f,body:a,redirect:"follow"},p=await fetch(`https://v2.api.noroff.dev/social/profiles/${s}`,d);if(!p.ok)throw console.error("Request failed:",p.status,p.statusText),new Error(`Failed to update profile picture: ${p.status} ${p.statusText}`);const y=await p.json();localStorage.setItem("avatar",o),alert("Your profile picture has been updated!"),location.reload()}catch(g){console.error("An error occurred while updating the profile picture:",g),alert("An error occurred while updating your profile picture.")}})}function oe(n){try{return new URL(n),!0}catch{return!1}}function se(){const n=j();if(!n){console.error("Failed to fetch token details.");return}const{cleanedToken:r,cleanedUsername:s}=n;if(!r||!s){console.error("Token or username is missing.");return}const i=document.getElementById("banner-input"),t=document.getElementById("change-banner-button");if(!i||!t){console.error("Required input or button elements are missing.");return}t.addEventListener("click",async e=>{e.preventDefault();const o=i.value.trim();if(!o||!ie(o)){alert("Please enter a valid URL."),console.error("Invalid or empty URL:",o);return}try{const g=await N();if(!g){console.error("Failed to fetch API key."),alert("Unable to fetch API key.");return}const f=new Headers;f.append("Content-Type","application/json"),f.append("X-Noroff-API-Key",g),f.append("Authorization",`Bearer ${r}`);const a=JSON.stringify({banner:{url:o,alt:"banner"}}),d={method:"PUT",headers:f,body:a,redirect:"follow"},p=await fetch(`https://v2.api.noroff.dev/social/profiles/${s}`,d);if(!p.ok)throw console.error("Request failed:",p.status,p.statusText),new Error(`Failed to update profile picture: ${p.status} ${p.statusText}`);const y=await p.json();localStorage.setItem("banner",o),alert("Your profile banner has been updated!"),location.reload()}catch(g){console.error("Error updating profile banner:",g),alert("An error occurred while updating your banner.")}})}function ie(n){try{return new URL(n),!0}catch{return!1}}const re=()=>{if(document.body.classList.contains("my-account-page")){if(!sessionStorage.getItem("myAccountReloaded")){sessionStorage.setItem("myAccountReloaded","true"),location.reload();return}document.getElementById("avatar-input")&&document.getElementById("change-avatar-button")&&ne(),document.getElementById("banner-input")&&document.getElementById("change-banner-button")&&se()}};async function z(n,r){if(!n){console.error("Listing ID is required to delete the listing.");return}const s=localStorage.getItem("token"),i=localStorage.getItem("api_key");if(!s||!i){console.error("API Key or Token is missing.");return}const t=`https://v2.api.noroff.dev/auction/listings/${n}`;if(console.log(`Attempting to delete listing at: ${t}`),!!confirm("Are you sure you want to delete this listing?"))try{const e=await fetch(t,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`,"X-Noroff-API-Key":i}});if(e.status===204)console.log("Listing deleted successfully."),alert("Listing deleted successfully."),r.remove();else throw new Error(`Failed to delete the listing. Status: ${e.status}`)}catch(e){console.error("Error deleting listing:",e),alert("Failed to delete the listing. Please try again.")}}function G(n="/account/login/"){return localStorage.getItem("token")?!0:(alert("You need to be logged in to view this listing. Please login or register."),window.location.href=n,!1)}function ae(){if(!G()||!document.body.classList.contains("my-account-page"))return;const n=localStorage.getItem("token"),r=localStorage.getItem("api_key"),s=localStorage.getItem("username");if(!n||!s||!r){console.error("Missing required authentication or user information.");return}const i=n.replace(/['"]+/g,""),t=s.replace(/['"]+/g,"");fetch(`https://v2.api.noroff.dev/auction/profiles/${t}/listings?_bids=true`,{method:"GET",headers:{"X-Noroff-API-Key":r,Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}).then(e=>{if(!e.ok)throw new Error("Failed to fetch listings");return e.json()}).then(e=>{const o=Array.isArray(e.data)?e.data:[];if(o.length===0){console.warn("No listings found for this user.");return}const g=document.getElementById("my-listings-container");if(!g){console.error("Listings container not found in DOM.");return}g.innerHTML="",o.filter(a=>{const d=a.endsAt?new Date(a.endsAt):null;return d&&d>new Date}).forEach(a=>{var u,w,b,v;const d=document.createElement("div");d.classList.add("flex","flex-col","p-4","bg-white","w-[350px]","rounded","shadow-md");const p=((w=(u=a.media)==null?void 0:u[0])==null?void 0:w.url)||"default-image.jpg",y=(b=a.bids)!=null&&b.length?Math.max(...a.bids.map(I=>I.amount)):"0",h=(v=a.tags)!=null&&v.length?a.tags.join(", "):"N/A",l=a.endsAt;let m="N/A";if(l){const E=new Date(l)-new Date;if(E>0){const S=Math.floor(E/864e5),L=Math.floor(E%(1e3*60*60*24)/(1e3*60*60)),k=Math.floor(E%(1e3*60)/(1e3*60));S>0?m=`${S} day${S>1?"s":""}`:L>0?m=`${L} hour${L>1?"s":""}`:m=`${k} minute${k>1?"s":""}`}else m="Ended"}d.innerHTML=`
                    <a href="/listing/view/index.html?id=${a.id}">
                        <img src="${p}" alt="${a.title}" class="mb-4 rounded object-cover w-full h-[220px]">
                        <h3 class="text-blue-950 font-bold text-lg">${a.title}</h3>
                        <div>
                            <span class="text-blue-950 font-bold">Current Bid:</span>
                            <span>${y} 🌕</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Description:</span>
                            <span class="italic">${a.description||"No description available"}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Category:</span>
                            <span>${h}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Ends in:</span>
                            <span>${m}</span>
                        </div>
                    </a>
                    <div class="mt-3 h-[50px]">
                        <a href="/listing/edit/index.html?id=${a.id}" class="bg-blue-950 hover:bg-blue-800 text-white rounded px-6 py-2">Edit</a>
                        <button data-listing-id="${a.id}" class="delete-listing-button bg-blue-950 hover:bg-blue-800 text-white rounded px-4 py-1.5 mt-2">Delete</button>
                    </div>
                `;const c=d.querySelector(".delete-listing-button");c&&c.addEventListener("click",()=>z(a.id,d)),g.appendChild(d)})}).catch(e=>{console.error("Error fetching listings:",e)})}document.addEventListener("DOMContentLoaded",async function(){R(),Z(),te(),K(),(document.getElementById("register-form")?O():null)&&Q();const r=localStorage.getItem("username");if(!r)return;const s=r.replace(/['"]+/g,""),i=document.querySelector(".logged-in-username");i&&(i.textContent=`Hello, ${s}! You are currently logged in.`),document.querySelectorAll(".visible-if-logged-in").forEach(e=>{e&&(e.style.display="block")}),re();try{await Promise.all([j(),N()]),ae()}catch(e){console.error("Error fetching required data:",e)}});const le=()=>{const n=document.getElementById("logout-button");n&&n.addEventListener("click",function(){console.log("Logout button clicked"),localStorage.clear(),sessionStorage.clear(),window.location.pathname.endsWith("/index.html")||window.location.pathname==="/"?window.location.reload():window.location.href="../../index.html"})};async function ce(){if(!document.body.classList.contains("create-listing-page"))return;const n=localStorage.getItem("token"),r=localStorage.getItem("api_key"),s=document.getElementById("new-listing-form"),i=document.getElementById("new-listing-title"),t=document.getElementById("new-listing-description"),e=document.getElementById("new-listing-category"),o=document.getElementById("new-listing-ends-at"),g=document.getElementById("new-listing-button");if(!s||!i||!t||!e||!o||!g){console.error("Required elements are missing.");return}g.addEventListener("click",async f=>{var l;f.preventDefault();const a=i.value.trim(),d=t.value.trim(),p=e.value.trim(),y=o.value.trim();if(!a||!d||!p||!y){alert("Please fill in all required fields.");return}const h=[];for(let m=1;m<=3;m++){const c=document.getElementById(`new-listing-image-${m}`).value.trim(),u=document.getElementById(`new-listing-image-alt-${m}`).value.trim();c&&u&&h.push({url:c,alt:u})}if(h.length===0){alert("Please provide at least one image with alt text.");return}try{const m=new Headers({"Content-Type":"application/json","X-Noroff-API-Key":r,Authorization:`Bearer ${n}`}),c=JSON.stringify({title:a,description:d,tags:p.split(",").map(v=>v.trim()),media:h,endsAt:y});console.log("Payload:",c);const u=await fetch("https://v2.api.noroff.dev/auction/listings",{method:"POST",headers:m,body:c});if(!u.ok)throw new Error(`Request failed: ${u.status} ${u.statusText}`);const w=await u.json();console.log("API Response:",w);const b=w.id||((l=w.data)==null?void 0:l.id);b?(alert("New listing created successfully!"),window.location.href=`/listing/view/index.html?id=${b}`):(console.error("Listing ID not found in the response."),alert("Failed to retrieve the listing ID. Please check your response."))}catch(m){console.error("Error creating new listing:",m),alert("Failed to create new listing.")}})}function de(){const n=document.querySelectorAll(".dropdownButton"),r=document.querySelectorAll(".dropdownMenuBottom");if(!n.length||!r.length){console.error("Dropdown buttons or menus not found.");return}n.forEach((s,i)=>{s.addEventListener("click",()=>{const t=r[i];t&&t.classList.toggle("hidden")})}),document.addEventListener("click",s=>{r.forEach((i,t)=>{const e=n[t];!i.contains(s.target)&&!e.contains(s.target)&&i.classList.add("hidden")})})}async function ue(){if(!document.body.classList.contains("view-profile-page"))return;const n=getUsernameFromURL(),r=localStorage.getItem("token"),s=localStorage.getItem("api_key");if(console.log("username: ",n),console.log("token: ",r),console.log("apiKey: ",s),!r)return console.error("No token found. User may not be logged in."),null;const i=new Headers;i.append("Authorization",`Bearer ${r}`),i.append("X-Noroff-API-Key",s);const t={method:"GET",headers:i,redirect:"follow"};try{const e=await fetch(`https://v2.api.noroff.dev/auction/profiles/${n}`,t);if(!e.ok)throw new Error(`Failed to fetch profile data: ${e.status} ${e.statusText}`);const o=await e.json(),g={name:o.data.name,email:o.data.email,avatar:o.data.avatar.url,banner:o.data.banner.url,credits:o.data.credits,listingsCount:o.data._count.listings,winsCount:o.data._count.wins};return localStorage.setItem("credits",o.data.credits),localStorage.setItem("listingsCount",o.data._count.listings),localStorage.setItem("winsCount",o.data._count.wins),localStorage.setItem("avatar",o.data.avatar.url),localStorage.setItem("banner",o.data.banner.url),g}catch(e){return console.error("Error fetching profile data:",e),null}}function ge(n){if(!n)return;const r=document.querySelector(".profile-name");r&&(r.textContent=n.name);const s=document.querySelector(".profile-email");s&&(s.textContent=n.email);const i=document.querySelector(".avatar-profile");n.avatar&&i&&(i.src=n.avatar);const t=document.querySelector(".banner-profile");n.banner&&t&&(t.src=n.banner);const e=document.querySelector(".profile-credits");e&&(e.textContent=`Credits: ${n.credits}`);const o=document.querySelector(".profile-listings-count");o&&(o.textContent=`Listings: ${n.listingsCount}`);const g=document.querySelector(".profile-wins-count");g&&(g.textContent=`Wins: ${n.winsCount}`)}function me(){if(!document.body.classList.contains("homepage"))return;const n=document.getElementById("carousel"),r=document.getElementById("prev-button"),s=document.getElementById("next-button"),i=document.getElementById("dots-container");async function t(){try{const o=await fetch("https://v2.api.noroff.dev/auction/listings?_bids=true",{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("Failed to fetch listings");return(await o.json()).data.filter(f=>f.bids&&f.bids.length>0&&new Date(f.endsAt)>new Date).sort((f,a)=>Math.max(...a.bids.map(d=>d.amount))-Math.max(...f.bids.map(d=>d.amount))).slice(0,3)}catch(o){return console.error("Error fetching highest bid listings:",o),[]}}async function e(){const o=await t();if(o.length===0){console.error("No active listings with bids available.");return}n.classList.add("flex","transition-transform","duration-500","ease-in-out");const g=(h,l)=>h?h.length>l?h.slice(0,l)+"...":h:"";o.forEach(h=>{const l=Math.max(...h.bids.map(u=>u.amount)),m=h.media&&h.media[0]&&h.media[0].url?h.media[0].url:"default-image.jpg",c=document.createElement("div");c.classList.add("carousel-slide","relative","w-full","h-[500px]","shrink-0","flex","items-center","justify-center"),c.innerHTML=`
                <div class="absolute inset-0">
                    <img src="${m}" alt="${h.title}" class="w-full h-full object-cover break-words truncate">
                </div>
                <div class="absolute inset-0 bg-black bg-opacity-50 flex flex-col justify-center items-center text-white p-4">
                    <h3 class="text-3xl font-bold mb-4 break-words truncate">${g(h.title,20)}</h3>
                    <p class="text-xl mb-2"><strong>Highest Bid:</strong> ${l} 🌕</p>
                    <p class="text-xl mb-4"><strong>Ends in:</strong> ${pe(h.endsAt)}</p>
                    <a href="/listing/view/index.html?id=${h.id}" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded">View Listing</a>
                </div>
            `,n.appendChild(c)}),o.forEach((h,l)=>{const m=document.createElement("div");m.classList.add("dot","w-3","h-3","bg-gray-400","rounded-full","cursor-pointer","mx-1"),m.addEventListener("click",()=>{f=l,d()}),i.appendChild(m)});let f=0;const a=o.length;function d(){const h=-f*100;n.style.transform=`translateX(${h}%)`,document.querySelectorAll(".dot").forEach((m,c)=>{c===f?(m.classList.add("bg-white","scale-125"),m.classList.remove("bg-gray-400","scale-100")):(m.classList.add("bg-gray-400","scale-100"),m.classList.remove("bg-white","scale-125"))})}function p(){f=(f+1)%a,d()}function y(){f=(f-1+a)%a,d()}s.addEventListener("click",p),r.addEventListener("click",y),d()}e()}function pe(n){const i=new Date(n)-new Date;if(i>0){const t=Math.floor(i/864e5),e=Math.floor(i%(1e3*60*60*24)/(1e3*60*60)),o=Math.floor(i%(1e3*60*60)/(1e3*60));return t>0?`${t} day${t>1?"s":""}`:e>0?`${e} hour${e>1?"s":""}`:`${o} minute${o>1?"s":""}`}else return"Ended"}async function H(n,r=9){if(!document.body.classList.contains("homepage"))return;let s=1,i=[];const t=document.getElementById("listings-container"),e=document.getElementById("pagination-container"),o=document.getElementById("tag-filter"),g=document.querySelectorAll(".search-input");async function f(l,m=100){let c=[],u=1,w=!0;for(;w;)try{const b=await fetch(`${l}?_seller=true&_bids=true&limit=${m}&page=${u}`);if(!b.ok)throw new Error(`Failed to fetch listings: ${b.status}`);const v=await b.json();if(c=c.concat(v.data||[]),w=(v.data||[]).length===m,u++,c.length>=1e3)break}catch(b){console.error("Error fetching listings:",b),w=!1}return c}const a=await f(n);i=a.filter(l=>{const m=l.endsAt?new Date(l.endsAt):null;return m&&m>new Date});function d(l){const m=(l-1)*r,c=m+r,u=i.slice(m,c);t.innerHTML="",u.forEach(w=>{var L,k,$,C;const b=document.createElement("div");b.classList.add("flex","flex-col","p-4","bg-white","w-[320px]","rounded","shadow-md","h-auto");const v=((k=(L=w.media)==null?void 0:L[0])==null?void 0:k.url)||"../../assets/placeholders/placeholder-pen-02.png",I=($=w.bids)!=null&&$.length?Math.max(...w.bids.map(B=>B.amount)):"0",x=w.endsAt;let E="N/A";if(x){const T=new Date(x)-new Date;if(T>0){const P=Math.floor(T/864e5),q=Math.floor(T%(1e3*60*60*24)/(1e3*60*60)),U=Math.floor(T%(1e3*60*60)/(1e3*60));P>0?E=`${P} day${P>1?"s":""}`:q>0?E=`${q} hour${q>1?"s":""}`:E=`${U} minute${U>1?"s":""}`}else E="Ended"}const S=(B,A)=>B?B.length>A?B.slice(0,A)+"...":B:"";b.innerHTML=`
                <img src="${v}" alt="${w.title}" class="mb-4 rounded h-[250px] object-cover">
                <h3 class="text-blue-950 font-bold text-lg break-words truncate">${w.title}</h3>
                <div>
                    <span class="text-blue-950 font-bold">Current Bid:</span>
                    <span>${I} 🌕</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Description:</span>
                    <span class="italic break-words">${S(w.description,30)}</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Ends in:</span>
                    <span>${E}</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Seller:</span>
                    <span>${((C=w.seller)==null?void 0:C.name)||"Unknown"}</span>
                </div>
                <a href="/listing/view/index.html?id=${w.id}" class="mt-4 bg-blue-950 hover:bg-orange-600 text-white py-2 px-4 rounded text-center">View Listing</a>
            `,t.appendChild(b)})}function p(){e.innerHTML="";const l=Math.ceil(i.length/r),m=5,c=(v,I,x=!1)=>{const E=document.createElement("button");return E.textContent=v,E.classList.add("px-3","py-1","border","rounded","mx-1","bg-orange-500","hover:bg-orange-700","text-white"),x&&E.classList.add("bg-orange-600","text-white"),E.addEventListener("click",()=>{s=I,d(s),p()}),E};s>1&&(e.appendChild(c("1",1)),e.appendChild(c("Previous",s-1)));const u=Math.max(1,s-Math.floor(m/2)),w=Math.min(l,u+m-1),b=Math.max(1,w-m+1);for(let v=b;v<=w;v++)e.appendChild(c(v,v,v===s));s<l&&(e.appendChild(c("Next",s+1)),e.appendChild(c(l,l)))}function y(){const l=Array.from(g).map(c=>c.value.toLowerCase()).join(" ").trim(),m=(o==null?void 0:o.value)||"";i=a.filter(c=>{var I,x,E,S,L,k,$,C,B,A;const u=c.endsAt?new Date(c.endsAt):null,w=u&&u>new Date,b=(!m||((I=c.tags)==null?void 0:I.includes(m)))&&w,v=!l||((x=c.title)==null?void 0:x.toLowerCase().includes(l))||((E=c.description)==null?void 0:E.toLowerCase().includes(l))||((k=(L=(S=c.media)==null?void 0:S[0])==null?void 0:L.alt)==null?void 0:k.toLowerCase().includes(l))||(($=c.tags)==null?void 0:$.some(T=>T.toLowerCase().includes(l)))||((B=(C=c.seller)==null?void 0:C.name)==null?void 0:B.toLowerCase().includes(l))||((A=c.id)==null?void 0:A.toLowerCase().includes(l));return b&&v}),s=1,d(s),p()}function h(){if(!o)return;const l=new Set;a.forEach(m=>{const c=m.endsAt?new Date(m.endsAt):null;c&&c>new Date&&m.tags&&m.tags.forEach(w=>l.add(w))}),o.innerHTML='<option value="">All Tags</option>',l.forEach(m=>{const c=document.createElement("option");c.value=m,c.textContent=m,o.appendChild(c)})}o&&o.addEventListener("change",y),g.length>0&&g.forEach(l=>l.addEventListener("input",y)),h(),d(s),p()}async function F(n){const r=document.getElementById("search-input"),s=document.querySelector("main");if(!r||!s){console.error("Search input or main element not found.");return}async function i(e,o=100){let g=[],f=1,a=!0;for(;a;)try{const d=await fetch(`${e}?_seller=true&_bids=true&limit=${o}&page=${f}`);if(!d.ok)throw new Error(`Failed to fetch listings: ${d.status}`);const p=await d.json();if(g=g.concat(p.data||[]),a=(p.data||[]).length===o,f++,g.length>=1e3)break}catch(d){console.error("Error fetching listings:",d),a=!1}return console.log("Fetched Listings for Search:",g),g}async function t(e){console.log("Search Query:",e);const g=(await i(n)).filter(a=>{var c,u,w,b,v,I;const d=(c=a.title)==null?void 0:c.toLowerCase().includes(e),p=(u=a.description)==null?void 0:u.toLowerCase().includes(e),y=(v=(b=(w=a.media)==null?void 0:w[0])==null?void 0:b.alt)==null?void 0:v.toLowerCase().includes(e),h=(I=a.tags)==null?void 0:I.some(x=>x.toLowerCase().includes(e)),l=a.endsAt?new Date(a.endsAt):null,m=l&&l>new Date;return(d||p||y||h)&&m});if(console.log("Filtered Results:",g),s.innerHTML="",g.length===0){s.innerHTML=`
                <div class="text-center py-8">
                    <h2 class="text-xl font-bold">No results found</h2>
                    <p>Try adjusting your search query.</p>
                </div>
            `;return}const f=document.createElement("div");f.classList.add("flex","flex-wrap","gap-4","justify-center","p-4","items-center","mx-auto","bg-gray-100"),g.forEach(a=>{var c,u,w,b;const d=document.createElement("div");d.classList.add("flex","flex-col","p-4","bg-white","w-[320px]","rounded","shadow-md","h-auto");const p=((u=(c=a.media)==null?void 0:c[0])==null?void 0:u.url)||"../../assets/placeholders/placeholder-pen-02.png",y=(w=a.bids)!=null&&w.length?Math.max(...a.bids.map(v=>v.amount)):"0",h=a.endsAt;let l="N/A";if(h){const x=new Date(h)-new Date;if(x>0){const E=Math.floor(x/864e5),S=Math.floor(x%(1e3*60*60*24)/(1e3*60*60)),L=Math.floor(x%(1e3*60*60)/(1e3*60));E>0?l=`${E} day${E>1?"s":""}`:S>0?l=`${S} hour${S>1?"s":""}`:l=`${L} minute${L>1?"s":""}`}else l="Ended"}const m=(v,I)=>v?v.length>I?v.slice(0,I)+"...":v:"";d.innerHTML=`
                <img src="${p}" alt="${a.title}" class="mb-4 rounded h-[250px] object-cover">
                <h3 class="text-blue-950 font-bold text-lg break-words truncate">${a.title}</h3>
                <div>
                    <span class="text-blue-950 font-bold">Current Bid:</span>
                    <span>${y} 🌕</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Description:</span>
                    <span class="italic break-words">${m(a.description,30)}</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Ends in:</span>
                    <span>${l}</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Seller:</span>
                    <span>${((b=a.seller)==null?void 0:b.name)||"Unknown"}</span>
                </div>
                <a href="/listing/view/index.html?id=${a.id}" class="mt-4 bg-blue-950 text-white py-2 px-4 rounded text-center">View Listing</a>
            `,f.appendChild(d)}),s.appendChild(f)}r.addEventListener("input",()=>{const e=r.value.toLowerCase();t(e)})}async function fe(){var i,t,e,o,g,f,a,d,p;if(!document.body.classList.contains("view-single-listing-page")||!G())return;const r=new URLSearchParams(window.location.search).get("id");if(!r){console.error("No listing ID found in URL");return}const s=`https://v2.api.noroff.dev/auction/listings/${r}?_seller=true&_bids=true`;try{const y=localStorage.getItem("token");if(!y){console.error("No token found. User may not be logged in.");return}const h=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${y}`}});if(!h.ok)throw new Error("Failed to fetch listing");const{data:l}=await h.json();document.querySelector(".view-single-listing-title").textContent=l.title||"No title available",document.querySelector(".view-single-listing-description").textContent=l.description||"No description available",document.querySelector(".single-listing-tags").textContent=((i=l.tags)==null?void 0:i.join(", "))||"No tags available";const m=document.querySelector(".view-single-listing-carousel"),c=document.querySelector(".view-single-listing-image-alt-text"),u=l.media||[];if(u.length>0){let I=0;const x=()=>{var $,C;const E=document.querySelector(".view-single-listing-image"),S=document.querySelector(".view-single-listing-image-alt-text");E.src=(($=u[I])==null?void 0:$.url)||"../../assets/placeholders/placeholder-pen.png",S.textContent=((C=u[I])==null?void 0:C.alt)||"No image description available";const L=document.getElementById("carousel-left-button"),k=document.getElementById("carousel-right-button");u.length===1?(L.style.display="none",k.style.display="none"):(L.style.display="inline-block",k.style.display="inline-block"),L.disabled=I<=0,k.disabled=I>=u.length-1};m.innerHTML=`
                <div class="carousel-image-container">
                    <img src="${u[0].url}" alt="${u[0].alt}" class="view-single-listing-image w-full h-[500px] object-cover">
                </div>
                <div class="view-single-listing-image-alt-text text-center italic text-blue-950 text-xs">${u[0].alt}</div>
                <div class="carousel-controls flex justify-center gap-4 mt-2">
                    <button id="carousel-left-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">◀</button>
                    <button id="carousel-right-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">▶</button>
                </div>
            `,document.getElementById("carousel-left-button").addEventListener("click",()=>{I>0&&(I--,x())}),document.getElementById("carousel-right-button").addEventListener("click",()=>{I<u.length-1&&(I++,x())}),x()}else m.innerHTML=`
                <img src="../../assets/placeholders/placeholder-pen.png" alt="No image available" class="view-single-listing-image w-full h-[500px] object-cover">
                <div class="view-single-listing-image-alt-text text-center italic text-blue-950 text-xs">No image alt text available</div>
            `;document.querySelector(".view-single-listing-seller-avatar").src=((e=(t=l.seller)==null?void 0:t.avatar)==null?void 0:e.url)||"../../assets/placeholders/avatar-placeholder.png",document.querySelector(".view-single-listing-seller-name").textContent=((o=l.seller)==null?void 0:o.name)||"Unknown Seller";const w=(g=l.bids)!=null&&g.length?Math.max(...l.bids.map(I=>I.amount)):"0";document.querySelector(".highest-bid-on-single-listing").textContent=`${w} 🌕`;const b=(f=l.bids)!=null&&f.length?(d=(a=l.bids[l.bids.length-1])==null?void 0:a.bidder)==null?void 0:d.name:"No bids yet";document.querySelector(".higest-bidder-dame").textContent=b;const v=document.querySelector(".bid-history-table");v&&((p=l.bids)!=null&&p.length)&&(v.innerHTML="",[...l.bids].sort((x,E)=>new Date(E.created)-new Date(x.created)).forEach(x=>{var S,L,k;const E=document.createElement("div");E.classList.add("bid-history-table","bg-white","flex","justify-between","p-4","m-4","items-center","text-blue-950","w-full"),E.innerHTML=`
                    <div>
                        <img src="${((L=(S=x.bidder)==null?void 0:S.avatar)==null?void 0:L.url)||"../../assets/placeholders/avatar-placeholder.png"}" alt="avatar"
                        class="bid-history-avatar w-[50px] h-[50px] object-cover mx-auto rounded-full overflow-hidden">
                    </div>
                    <div class="bid-history-username font-bold">${((k=x.bidder)==null?void 0:k.name)||"Anonymous"}</div>
                    <div class="bid-history-date">${new Date(x.created).toLocaleDateString()}</div>
                    <div class="bid-history-amount-of-bid font-bold">${x.amount} 🌕</div>
                `,v.appendChild(E)}))}catch(y){console.error("Error fetching single listing:",y)}}function he(){if(!document.body.classList.contains("view-single-listing-page"))return;const n=document.querySelector(".copy-link-to-listing");if(!n){console.error("Copy link element not found in the DOM.");return}n.addEventListener("click",()=>{const r=window.location.href;navigator.clipboard.writeText(r).then(()=>{alert("Successfully copied the link to this listing")}).catch(s=>{console.error("Failed to copy the link:",s),alert("Failed to copy the link. Please try again.")})})}function ye(){if(!document.body.classList.contains("view-single-listing-page"))return;const n=document.getElementById("place-bid-button"),r=document.getElementById("place-bid");if(!n||!r){console.error("Bid button or input field not found.");return}n.addEventListener("click",async s=>{s.preventDefault();const i=parseFloat(r.value);if(isNaN(i)||i<=0){alert("Please enter a valid bid amount.");return}const e=new URLSearchParams(window.location.search).get("id");if(!e){console.error("Listing ID not found in the URL."),alert("Could not determine the listing to place a bid.");return}const o=localStorage.getItem("api_key"),g=localStorage.getItem("token");if(!o||!g){console.error("API key or access token not found in localStorage."),alert("Unable to authenticate. Please log in again.");return}const f={method:"POST",headers:{"X-Noroff-API-Key":o,"Content-Type":"application/json",Authorization:`Bearer ${g}`},body:JSON.stringify({amount:i})};try{console.log(`Placing bid on listing ${e} with amount ${i}`);const a=await fetch(`https://v2.api.noroff.dev/auction/listings/${e}/bids`,f);if(!a.ok){const p=await a.json();console.error("Error response from API:",p),alert(`Error placing bid: ${p.message||"An unexpected error occurred."}`);return}const d=await a.json();console.log("Bid placed successfully:",d),alert("Bid placed successfully!"),location.reload()}catch(a){console.error("Error placing bid:",a),alert("An error occurred while placing your bid. Please try again later.")}})}function we(){if(!document.body.classList.contains("my-account-page"))return;const n=localStorage.getItem("token"),r=localStorage.getItem("api_key"),s=localStorage.getItem("username"),i=n.replace(/['"]+/g,""),t=s.replace(/['"]+/g,"");fetch(`https://v2.api.noroff.dev/auction/profiles/${t}?_wins=true`,{method:"GET",headers:{"X-Noroff-API-Key":r,Authorization:`Bearer ${i}`,"Content-Type":"application/json"}}).then(e=>{if(e.ok)return e.json();throw new Error("Failed to fetch user wins")}).then(e=>{var f;const o=((f=e==null?void 0:e.data)==null?void 0:f.wins)||[];if(o.length===0){console.log("No won listings found.");return}const g=document.getElementById("user-wins-container");if(!g){console.error("User wins container not found in the DOM");return}g.innerHTML="",o.forEach(a=>{var y,h,l;const d=document.createElement("div");d.classList.add("flex","flex-col","p-4","bg-white","w-[320px]","rounded","shadow-md","h-auto");const p=((h=(y=a.media)==null?void 0:y[0])==null?void 0:h.url)||"../../assets/placeholders/placeholder-pen-02.png";d.innerHTML=`
                    <a href="/listing/view/index.html?id=${a.id}" class="block">
                        <img src="${p}" alt="${a.title}" class="mb-4 rounded h-[250px] object-cover">
                        <h3 class="text-blue-950 font-bold text-lg break-words truncate">${a.title}</h3>
                        <div>
                            <span class="text-blue-950 font-bold">Description:</span>
                            <span class="italic break-words">${a.description||"No description available"}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Category:</span>
                            <span>${((l=a.tags)==null?void 0:l.join(", "))||"N/A"}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Ended At:</span>
                            <span>${new Date(a.endsAt).toLocaleDateString()||"Unknown"}</span>
                        </div>
                    </a>
                `,g.appendChild(d)})}).catch(e=>{console.error("Error fetching user wins:",e)})}function ve(){if(!document.body.classList.contains("create-listing-page"))return;const n=document.getElementById("new-listing-title"),r=document.getElementById("new-listing-description"),s=document.getElementById("new-listing-category"),i=[document.getElementById("new-listing-image-1"),document.getElementById("new-listing-image-2"),document.getElementById("new-listing-image-3")],t=[document.getElementById("new-listing-image-alt-1"),document.getElementById("new-listing-image-alt-2"),document.getElementById("new-listing-image-alt-3")],e=document.querySelector(".review-new-listing-title"),o=document.querySelector(".review-new-listing-description"),g=document.querySelector(".review-new-listing-tags"),f=document.querySelector(".review-new-listing-image"),a=document.querySelector(".review-new-listing-image-alt-text"),d=document.createElement("button"),p=document.createElement("button");d.textContent="◀",p.textContent="▶";let y=0;const h=()=>{var w,b;const c=i.filter(v=>v.value),u=c.length;u>0?(y=Math.min(y,u-1),f.src=((w=c[y])==null?void 0:w.value)||"../../assets/placeholders/placeholder-pen.png",a.textContent=((b=t[y])==null?void 0:b.value)||"Image alt text goes here"):(f.src="../../assets/placeholders/placeholder-pen.png",a.textContent="Image alt text goes here"),d.disabled=y<=0,p.disabled=y>=u-1},l=()=>{e.textContent=n.value||"Listing title",o.textContent=r.value||"Lorem ipsum description goes here...",g.textContent=s.value||"Category",h()};d.addEventListener("click",()=>{y>0&&(y--,h())}),p.addEventListener("click",()=>{const c=i.filter(u=>u.value).length;y<c-1&&(y++,h())}),n.addEventListener("input",l),r.addEventListener("input",l),s.addEventListener("input",l),i.forEach(c=>c.addEventListener("input",h)),t.forEach(c=>c.addEventListener("input",h));const m=document.querySelector(".review-new-listing-carousel");m.appendChild(d),m.appendChild(p),l()}async function be(){var m;if(!document.body.classList.contains("edit-listing-page"))return;const n=localStorage.getItem("token");localStorage.getItem("api_key");const s=new URLSearchParams(window.location.search).get("id");if(!s){console.error("No listing ID found in URL.");return}const i=`https://v2.api.noroff.dev/auction/listings/${s}?_seller=true&_bids=true`,t=document.getElementById("edit-listing-title"),e=document.getElementById("edit-listing-description"),o=document.getElementById("edit-listing-category"),g=[document.getElementById("edit-listing-image-1"),document.getElementById("edit-listing-image-2"),document.getElementById("edit-listing-image-3")],f=[document.getElementById("edit-listing-image-alt-1"),document.getElementById("edit-listing-image-alt-2"),document.getElementById("edit-listing-image-alt-3")],a=document.querySelector(".view-edit-listing-title"),d=document.querySelector(".view-edit-listing-description"),p=document.querySelector(".edit-listing-tags"),y=document.querySelector(".view-edit-listing-image"),h=document.querySelector(".view-edit-listing-image-alt-text"),l=()=>{var w,b;a.textContent=t.value||"Listing title",d.textContent=e.value||"Lorem ipsum description goes here...",p.textContent=o.value||"Category";const c=((w=g[0])==null?void 0:w.value)||"../../assets/placeholders/placeholder-pen.png",u=((b=f[0])==null?void 0:b.value)||"Image alt text goes here";y.src=c,h.textContent=u};try{const c=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!c.ok)throw new Error("Failed to fetch listing details.");const u=await c.json();t.value=u.title||"",e.value=u.description||"",o.value=((m=u.tags)==null?void 0:m.join(", "))||"",(u.media||[]).forEach((b,v)=>{g[v]&&(g[v].value=b.url||"",f[v].value=b.alt||"")}),l()}catch(c){console.error("Error fetching listing details:",c)}t.addEventListener("input",l),e.addEventListener("input",l),o.addEventListener("input",l),g.forEach((c,u)=>{var w;c.addEventListener("input",l),(w=f[u])==null||w.addEventListener("input",l)})}async function X(){var t;if(console.log("Checking if the page is the edit listing page..."),!document.body.classList.contains("edit-listing-page")){console.warn("This is not the edit listing page. Exiting function.");return}const n=localStorage.getItem("token");if(!n){console.error("No token found. User may not be logged in.");return}const s=new URLSearchParams(window.location.search).get("id");if(!s){console.error("No listing ID found in the URL.");return}const i=`https://v2.api.noroff.dev/auction/listings/${s}?_seller=true&_bids=true`;console.log("Fetching listing from:",i);try{const e=await fetch(i,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${n}`}});if(!e.ok)throw new Error(`Failed to fetch listing. Status: ${e.status}`);const o=await e.json();if(console.log("Fetched listing data:",o),!o||!o.data)throw new Error("Invalid listing data received from the API.");Ee(o.data),J(o.data.media);const g=(t=o.data.bids)!=null&&t.length?Math.max(...o.data.bids.map(a=>a.amount)):"0",f=document.querySelector(".highest-bid-on-edit-listing");f?f.textContent=`${g} 🌕`:console.warn("Highest bid element not found in the DOM.")}catch(e){console.error("Error fetching or populating listing data:",e)}}function Ee(n){var r,s,i,t,e;console.log("Populating input fields..."),document.getElementById("edit-listing-title").value=n.title||"",document.getElementById("edit-listing-description").value=n.description||"",document.getElementById("edit-listing-category").value=((r=n.tags)==null?void 0:r.join(", "))||"";for(let o=0;o<3;o++){const g=document.getElementById(`edit-listing-image-${o+1}`),f=document.getElementById(`edit-listing-image-alt-${o+1}`);g&&(g.value=((i=(s=n.media)==null?void 0:s[o])==null?void 0:i.url)||""),f&&(f.value=((e=(t=n.media)==null?void 0:t[o])==null?void 0:e.alt)||"")}console.log("Input fields populated with:",{title:n.title,description:n.description,tags:n.tags})}function J(n=[]){console.log("Updating edit listing preview...");const r=document.getElementById("edit-listing-title").value||"No title available",s=document.getElementById("edit-listing-description").value||"No description available",i=document.getElementById("edit-listing-category").value||"No category available";document.querySelector(".view-edit-listing-title").textContent=r,document.querySelector(".view-edit-listing-description").textContent=s,document.querySelector(".edit-listing-tags").textContent=i;const t=document.querySelector(".view-edit-listing-carousel");if(!t){console.error("Carousel container not found.");return}if(n.length>0){let e=0;const o=()=>{var p,y;const g=document.querySelector(".view-edit-listing-image"),f=document.querySelector(".view-edit-listing-image-alt-text");g&&f&&(g.src=((p=n[e])==null?void 0:p.url)||"../../assets/placeholders/placeholder-pen.png",f.textContent=((y=n[e])==null?void 0:y.alt)||"No description available");const a=document.getElementById("carousel-left-button"),d=document.getElementById("carousel-right-button");n.length===1?(a.style.display="none",d.style.display="none"):(a.style.display="inline-block",d.style.display="inline-block"),a.disabled=e<=0,d.disabled=e>=n.length-1};t.innerHTML=`
            <div class="carousel-image-container">
                <img src="${n[0].url}" alt="${n[0].alt}" class="view-edit-listing-image w-full h-[500px] object-cover">
            </div>
            <div class="view-edit-listing-image-alt-text text-center italic text-blue-950 text-xs">${n[0].alt}</div>
            <div class="carousel-controls flex justify-center gap-4 mt-2">
                <button id="carousel-left-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">◀</button>
                <button id="carousel-right-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">▶</button>
            </div>
        `,document.getElementById("carousel-left-button").addEventListener("click",()=>{e>0&&(e--,o())}),document.getElementById("carousel-right-button").addEventListener("click",()=>{e<n.length-1&&(e++,o())}),o()}else t.innerHTML=`
            <img src="../../assets/placeholders/placeholder-pen.png" alt="No image available" class="view-edit-listing-image w-full h-[500px] object-cover">
            <div class="view-edit-listing-image-alt-text text-center italic text-blue-950 text-xs">No image alt text available</div>
        `;console.log("Preview updated with:",{title:r,description:s,category:i})}document.addEventListener("DOMContentLoaded",async()=>{console.log("DOMContentLoaded event fired."),await X(),["edit-listing-title","edit-listing-description","edit-listing-category","edit-listing-image-1","edit-listing-image-2","edit-listing-image-3","edit-listing-image-alt-1","edit-listing-image-alt-2","edit-listing-image-alt-3"].forEach(n=>{const r=document.getElementById(n);r&&r.addEventListener("input",()=>{const s=Array.from({length:3},(i,t)=>{var e,o;return{url:(e=document.getElementById(`edit-listing-image-${t+1}`))==null?void 0:e.value,alt:(o=document.getElementById(`edit-listing-image-alt-${t+1}`))==null?void 0:o.value}}).filter(i=>i.url);J(s)})})});async function M(n){if(!document.body.classList.contains("edit-listing-page"))return;n.preventDefault();const r=localStorage.getItem("token");if(!r){console.error("No token found. User may not be logged in.");return}const i=new URLSearchParams(window.location.search).get("id");if(!i){console.error("No listing ID found in the URL.");return}const t=`https://v2.api.noroff.dev/auction/listings/${i}`,e=document.getElementById("edit-listing-title").value,o=document.getElementById("edit-listing-description").value,g=document.getElementById("edit-listing-category").value.split(",").map(p=>p.trim()).filter(p=>p),f=[];for(let p=1;p<=3;p++){const y=document.getElementById(`edit-listing-image-${p}`).value,h=document.getElementById(`edit-listing-image-alt-${p}`).value;y&&f.push({url:y,alt:h||"No description available"})}const a={title:e,description:o,tags:g,media:f},d=localStorage.getItem("api_key");try{const p=await fetch(t,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${r}`,"X-Noroff-API-Key":d},body:JSON.stringify(a)});if(!p.ok)throw new Error(`Failed to save listing. Status: ${p.status}`);alert("Listing successfully updated!"),window.location.href=`../../listing/view/index.html?id=${i}`}catch(p){console.error("Error saving listing:",p),alert("Failed to save the listing. Please try again.")}}function Ie(){const n=document.getElementById("edit-listing-button");n&&n.addEventListener("click",M)}function xe(){const r="pageRefreshCount";let s=parseInt(localStorage.getItem(r))||0;s<1?(localStorage.setItem(r,s+1),location.reload()):localStorage.removeItem(r)}document.addEventListener("DOMContentLoaded",async function(){xe(),le(),ce(),me(),fe(),he(),ye(),de(),we(),ve(),be(),X(),M(),Ie();try{const t=await fetch("https://v2.api.noroff.dev/auction/listings?_bids=true",{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error("Failed to fetch listings");const o=(await t.json()).data||[];H(o),H("https://v2.api.noroff.dev/auction/listings"),F(o),F("https://v2.api.noroff.dev/auction/listings")}catch(t){console.error("Error fetching listings:",t)}const n=await ue();n&&ge(n);const r=localStorage.getItem("username");if(r){const t=r.replace(/['"]+/g,""),e=document.querySelector(".logged-in-username");e&&(e.textContent="Hello, "+t+"! You are currently logged in.");const o=document.querySelector(".visible-if-logged-in");o&&(o.style.display="block")}const s=document.getElementById("edit-listing-button");s&&s.addEventListener("click",M);const i=document.querySelectorAll(".delete-listing-button");i.length,i.forEach(t=>{const e=t.getAttribute("data-listing-id"),o=t.closest(".listing-card");if(!e||!o){console.error("Missing listing ID or listing card for delete button.");return}console.log(`Attaching delete listener to listing ID: ${e}`),t.addEventListener("click",()=>{z(e,o)})})});
