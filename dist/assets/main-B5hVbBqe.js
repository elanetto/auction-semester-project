(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const e of t)if(e.type==="childList")for(const o of e.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?e.credentials="include":t.crossOrigin==="anonymous"?e.credentials="omit":e.credentials="same-origin",e}function i(t){if(t.ep)return;t.ep=!0;const e=s(t);fetch(t.href,e)}})();const E=()=>{const n=document.getElementById("logout-button");n&&n.addEventListener("click",function(){console.log("Logout button clicked"),localStorage.clear(),sessionStorage.clear(),window.location.pathname.endsWith("/index.html")||window.location.pathname==="/"?window.location.reload():window.location.href="../../index.html"})};async function v(){if(!document.body.classList.contains("create-listing-page"))return;const n=localStorage.getItem("token"),r=localStorage.getItem("api_key"),s=document.getElementById("new-listing-form"),i=document.getElementById("new-listing-title"),t=document.getElementById("new-listing-description"),e=document.getElementById("new-listing-category"),o=document.getElementById("new-listing-image"),a=document.getElementById("new-listing-ends-at"),u=document.getElementById("new-listing-button");if(!s||!i||!t||!e||!o||!u||!a){console.error("Required input or button elements are missing.");return}u.addEventListener("click",async p=>{console.log("New listing button clicked."),p.preventDefault();const c=i.value.trim(),m=t.value.trim(),g=e.value.trim(),f=o.value.trim(),y=a.value.trim();if(!c||!m||!g||!f||!y){alert("Please fill in all fields correctly."),console.error("One or more fields are empty or invalid.");return}try{const d=new Headers({"Content-Type":"application/json","X-Noroff-API-Key":r,Authorization:`Bearer ${n}`}),w=JSON.stringify({title:c,description:m,tags:g,media:[{url:f,alt:c}],endsAt:y});console.log("Request Payload:",w);const l=await fetch("https://v2.api.noroff.dev/auction/listings",{method:"POST",headers:d,body:w});if(!l.ok)throw new Error(`New listing request failed: ${l.status} ${l.statusText}`);const h=await l.json();console.log("New listing created successfully:",h),alert("New listing created successfully!")}catch(d){console.error("Error creating new listing:",d.message),alert("Failed to create new listing.")}})}function I(n){const r=document.getElementById(n);r&&r.classList.toggle("hidden")}async function S(){const n=getUsernameFromURL(),r=localStorage.getItem("token"),s=localStorage.getItem("api_key");if(console.log("username: ",n),console.log("token: ",r),console.log("apiKey: ",s),!r)return console.error("No token found. User may not be logged in."),null;const i=new Headers;i.append("Authorization",`Bearer ${r}`),i.append("X-Noroff-API-Key",s);const t={method:"GET",headers:i,redirect:"follow"};try{const e=await fetch(`https://v2.api.noroff.dev/auction/profiles/${n}`,t);if(!e.ok)throw new Error(`Failed to fetch profile data: ${e.status} ${e.statusText}`);const o=await e.json(),a={name:o.data.name,email:o.data.email,avatar:o.data.avatar.url,banner:o.data.banner.url,credits:o.data.credits,listingsCount:o.data._count.listings,winsCount:o.data._count.wins};return localStorage.setItem("credits",o.data.credits),localStorage.setItem("listingsCount",o.data._count.listings),localStorage.setItem("winsCount",o.data._count.wins),localStorage.setItem("avatar",o.data.avatar.url),localStorage.setItem("banner",o.data.banner.url),a}catch(e){return console.error("Error fetching profile data:",e),null}}function L(n){if(!n)return;const r=document.querySelector(".profile-name");r&&(r.textContent=n.name);const s=document.querySelector(".profile-email");s&&(s.textContent=n.email);const i=document.querySelector(".avatar-profile");n.avatar&&i&&(i.src=n.avatar);const t=document.querySelector(".banner-profile");n.banner&&t&&(t.src=n.banner);const e=document.querySelector(".profile-credits");e&&(e.textContent=`Credits: ${n.credits}`);const o=document.querySelector(".profile-listings-count");o&&(o.textContent=`Listings: ${n.listingsCount}`);const a=document.querySelector(".profile-wins-count");a&&(a.textContent=`Wins: ${n.winsCount}`)}document.addEventListener("DOMContentLoaded",async function(){E(),v(),console.log("dropdown loaded");const n=document.getElementById("dropdownButton");n&&n.addEventListener("click",function(){I("dropdownMenuBottom")});const r=await S();r&&L(r);const s=localStorage.getItem("username");if(s){const i=s.replace(/['"]+/g,""),t=document.querySelector(".logged-in-username");t&&(t.textContent="Hello, "+i+"! You are currently logged in.");const e=document.querySelector(".visible-if-logged-in");e&&(e.style.display="block")}});
