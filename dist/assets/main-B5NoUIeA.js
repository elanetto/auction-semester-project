(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const t of n)if(t.type==="childList")for(const o of t.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&a(o)}).observe(document,{childList:!0,subtree:!0});function s(n){const t={};return n.integrity&&(t.integrity=n.integrity),n.referrerPolicy&&(t.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?t.credentials="include":n.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(n){if(n.ep)return;n.ep=!0;const t=s(n);fetch(n.href,t)}})();function K(e){const i=e.currentTarget,s=i.previousElementSibling;console.log("Show Password Button Clicked:",i),console.log("Password Input Element:",s),s?s.type==="password"?(s.type="text",i.querySelector(".fa-eye-slash").classList.add("hide"),i.querySelector(".fa-eye").classList.remove("hide")):(s.type="password",i.querySelector(".fa-eye-slash").classList.remove("hide"),i.querySelector(".fa-eye").classList.add("hide")):console.error("Password input not found.")}const W="https://v2.api.noroff.dev",Q=`${W}/auth`,Z=`${Q}/register`,ee=()=>{const e=document.getElementById("login-email"),i=document.getElementById("login-password"),s=document.querySelector(".show-password"),a=document.getElementById("login-error"),n=document.getElementById("login-btn");return{email:e,password:i,showPasswordBtn:s,errorMessage:a,loginBtn:n}},z=()=>{const e=document.getElementById("username"),i=document.getElementById("register-email"),s=document.getElementById("register-password"),a=document.querySelector(".show-password"),n=document.getElementById("error-message"),t=document.getElementById("success-message"),o=document.getElementById("register-btn");return{username:e,email:i,password:s,showPasswordBtn:a,errorMessage:n,successMessage:t,registerBtn:o}};function te(){const{username:e,email:i,password:s,showPasswordBtn:a,errorMessage:n,successMessage:t,registerBtn:o}=z();if(!a||!s){console.error("Required elements for show-password functionality are missing.");return}a.addEventListener("click",K),o.addEventListener("click",async function(d){if(d.preventDefault(),n.style.display="none",t.style.display="none",e.value.length<2||i.value.length<2||s.value.length<2){n.style.display="block",n.innerHTML="All fields must be filled in.",console.log("All fields must be filled in.");return}if(s.value.length<9){n.innerHTML="The password must contain more than 9 characters.",n.style.display="block",console.log("The password must contain more than 9 characters.");return}if(s.value.length>20){n.innerHTML="The password must contain less than 20 characters.",n.style.display="block",console.log("The password must contain less than 20 characters.");return}if(!i.value.includes("@stud.noroff.no")){n.innerHTML="The email must end with @stud.noroff.no.",n.style.display="block",console.log("The email must end with @stud.noroff.no.");return}if(!/^[a-zA-Z0-9]+$/.test(e.value)){n.innerHTML="The username must only contain letters and numbers.",n.style.display="block",console.log("The username must only contain letters and numbers.");return}const c={name:e.value,email:i.value,bio:"Default bio",avatar:{url:"https://github.com/elanetto/FED1-PE1-elanetto/blob/main/assets/images/user/avatar-user-default.png?raw=true",alt:"User  Avatar"},banner:{url:"https://github.com/elanetto/FED1-PE1-elanetto/blob/main/assets/images/200kb-images/kewater_view-01.jpg?raw=true",alt:"User  Banner"},venueManager:!0,password:s.value};try{const r=await fetch(Z,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)}),u=await r.json();if(console.log(u),u.errors){console.log(u.errors),n.style.display="block",n.innerHTML=u.errors.map(g=>g.message).join("<br>"),console.log(u.errors);return}r.ok&&(t.style.display="block",console.log("User registered successfully."),alert("User registered successfully. You will be redirected to the login page."),setTimeout(()=>{window.location.href="../login/"},2e3))}catch(r){console.log(r),n.style.display="block",n.innerHTML="Something went wrong. Please try again."}document.querySelector(".register-form").reset()})}async function N(){const e=localStorage.getItem("token"),i=localStorage.getItem("username"),s=localStorage.getItem("api_key");if(!e||!i||!s)return console.error("Missing authentication data."),null;const a=new Headers;a.append("Authorization",`Bearer ${e}`),a.append("X-Noroff-API-Key",s);try{const n=await fetch(`https://v2.api.noroff.dev/auction/profiles/${i}`,{method:"GET",headers:a});if(!n.ok)throw new Error(`Failed to fetch profile data: ${n.status}`);const t=await n.json();localStorage.setItem("credits",t.data.credits),localStorage.setItem("listingsCount",t.data._count.listings),localStorage.setItem("winsCount",t.data._count.wins);const o=document.querySelector(".my-credits");return o&&(o.textContent=t.data.credits),t.data}catch(n){return console.error("Error fetching profile data:",n),null}}function ne(){if(!document.body.classList.contains("login-page"))return;const e=document.querySelector("#login-form"),i=document.querySelector("#login-error"),s=document.querySelector(".eye-container.show-password");s?s.addEventListener("click",K):console.error("Show password button not found."),e?e.addEventListener("submit",async a=>{a.preventDefault(),await oe(i)}):console.error("Login form not found.")}async function oe(e){var t,o;const i=document.querySelector("#login-email"),s=document.querySelector("#login-password"),a=i.value.trim(),n=s.value.trim();if(!se(a)){e.textContent="Invalid email format.",e.style.display="block";return}if(!n){e.textContent="Password cannot be empty.",e.style.display="block";return}e.textContent="Logging in...",e.style.color="blue",e.style.display="block";try{const d=await fetch("https://v2.api.noroff.dev/auth/login",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a,password:n})}),c=await d.json();if(d.ok){const{name:r,email:u,avatar:g,banner:v,accessToken:p}=c.data;localStorage.setItem("username",r),localStorage.setItem("email",u),localStorage.setItem("token",p),localStorage.setItem("avatar",(g==null?void 0:g.url)||""),localStorage.setItem("banner",(v==null?void 0:v.url)||""),localStorage.setItem("bio",c.data.bio||""),await N()?console.log("Profile data fetched successfully."):console.error("Failed to fetch profile data."),sessionStorage.setItem("refreshCounter","0"),e.textContent="Login successful!",e.style.color="green",window.location.href="../../account/myaccount/"}else{const r=((o=(t=c.errors)==null?void 0:t[0])==null?void 0:o.message)||"Login failed. Please try again.";e.textContent=r,e.style.color="red"}}catch(d){console.error("Login error:",d),e.textContent="An error occurred. Please try again.",e.style.color="red"}}function se(e){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e)}function ie(){const e=localStorage.getItem("username"),i=localStorage.getItem("email"),s=localStorage.getItem("avatar"),a=localStorage.getItem("banner"),n=localStorage.getItem("credits"),t=localStorage.getItem("listingsCount"),o=localStorage.getItem("winsCount"),d=localStorage.getItem("bio");document.querySelectorAll(".username-from-local-storage").forEach(l=>{e&&(l.textContent=e)}),document.querySelectorAll(".email-from-local-storage").forEach(l=>{i&&(l.textContent=i)});const u=document.querySelector(".avatar-from-local-storage");s&&u&&(u.src=s),document.querySelectorAll(".my-avatar").forEach(l=>{s&&(l.src=s)});const v=document.querySelector(".banner-from-local-storage");a&&v&&(v.src=a),document.querySelectorAll(".my-credits").forEach(l=>{l.innerText=n}),document.querySelectorAll(".my-listings-count").forEach(l=>{l.innerText=t}),document.querySelectorAll(".my-wins-count").forEach(l=>{l.innerText=o}),document.querySelectorAll(".my-bio").forEach(l=>{l.innerText=d})}function U(){const e=localStorage.getItem("token");if(!e){console.error("No token found");return}const i=e.replace(/['"]+/g,""),s=new Headers;return s.append("Authorization",`Bearer ${i}`),fetch("https://v2.api.noroff.dev/auth/create-api-key",{method:"POST",headers:s,redirect:"follow"}).then(n=>{if(!n.ok)throw new Error(`API key request failed: ${n.status} ${n.statusText}`);return n.json()}).then(n=>{var o;const t=(o=n==null?void 0:n.data)==null?void 0:o.key;if(!t)throw new Error("API key not found in response");return localStorage.setItem("api_key",t),t}).catch(n=>(console.error("Error fetching API key:",n),null))}function j(){const e=localStorage.getItem("token"),i=localStorage.getItem("username");if(!e)return null;const s=e.replace(/['"]+/g,"");if(!i)return null;const a=i.replace(/['"]+/g,"");return{cleanedToken:s,cleanedUsername:a}}function ae(){const e=j();if(!e){console.warn("Token details are not available. Skipping profile picture setup.");return}const{cleanedToken:i,cleanedUsername:s}=e,a=document.getElementById("avatar-input"),n=document.getElementById("change-avatar-button");if(!a||!n){console.warn("Profile picture input or button not found. Skipping setup.");return}n.addEventListener("click",async t=>{t.preventDefault();const o=a.value.trim();if(!o||!re(o)){alert("Please enter a valid URL.");return}try{const d=await U();if(!d){alert("Unable to fetch API key.");return}const c=new Headers;c.append("Content-Type","application/json"),c.append("X-Noroff-API-Key",d),c.append("Authorization",`Bearer ${i}`);const r=JSON.stringify({avatar:{url:o,alt:"Avatar"}}),u={method:"PUT",headers:c,body:r,redirect:"follow"},g=await fetch(`https://v2.api.noroff.dev/social/profiles/${s}`,u);if(!g.ok)throw console.error("Request failed:",g.status,g.statusText),new Error(`Failed to update profile picture: ${g.status} ${g.statusText}`);const v=await g.json();localStorage.setItem("avatar",o),alert("Your profile picture has been updated!"),location.reload()}catch(d){console.error("An error occurred while updating the profile picture:",d),alert("An error occurred while updating your profile picture.")}})}function re(e){try{return new URL(e),!0}catch{return!1}}function le(){const e=j();if(!e){console.error("Failed to fetch token details.");return}const{cleanedToken:i,cleanedUsername:s}=e;if(!i||!s){console.error("Token or username is missing.");return}const a=document.getElementById("banner-input"),n=document.getElementById("change-banner-button");if(!a||!n){console.error("Required input or button elements are missing.");return}n.addEventListener("click",async t=>{t.preventDefault();const o=a.value.trim();if(!o||!ce(o)){alert("Please enter a valid URL."),console.error("Invalid or empty URL:",o);return}try{const d=await U();if(!d){console.error("Failed to fetch API key."),alert("Unable to fetch API key.");return}const c=new Headers;c.append("Content-Type","application/json"),c.append("X-Noroff-API-Key",d),c.append("Authorization",`Bearer ${i}`);const r=JSON.stringify({banner:{url:o,alt:"banner"}}),u={method:"PUT",headers:c,body:r,redirect:"follow"},g=await fetch(`https://v2.api.noroff.dev/social/profiles/${s}`,u);if(!g.ok)throw console.error("Request failed:",g.status,g.statusText),new Error(`Failed to update profile picture: ${g.status} ${g.statusText}`);const v=await g.json();localStorage.setItem("banner",o),alert("Your profile banner has been updated!"),location.reload()}catch(d){console.error("Error updating profile banner:",d),alert("An error occurred while updating your banner.")}})}function ce(e){try{return new URL(e),!0}catch{return!1}}const de=()=>{if(document.body.classList.contains("my-account-page")){if(!sessionStorage.getItem("myAccountReloaded")){sessionStorage.setItem("myAccountReloaded","true"),location.reload();return}document.getElementById("avatar-input")&&document.getElementById("change-avatar-button")&&ae(),document.getElementById("banner-input")&&document.getElementById("change-banner-button")&&le()}};async function X(e,i){if(!e){console.error("Listing ID is required to delete the listing.");return}const s=localStorage.getItem("token"),a=localStorage.getItem("api_key");if(!s||!a){console.error("API Key or Token is missing.");return}const n=`https://v2.api.noroff.dev/auction/listings/${e}`;if(console.log(`Attempting to delete listing at: ${n}`),!!confirm("Are you sure you want to delete this listing?"))try{const t=await fetch(n,{method:"DELETE",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`,"X-Noroff-API-Key":a}});if(t.status===204)console.log("Listing deleted successfully."),alert("Listing deleted successfully."),i.remove();else throw new Error(`Failed to delete the listing. Status: ${t.status}`)}catch(t){console.error("Error deleting listing:",t),alert("Failed to delete the listing. Please try again.")}}function G(e="/account/login/"){return localStorage.getItem("token")?!0:(alert("You need to be logged in to view this listing. Please login or register."),window.location.href=e,!1)}function ue(){if(!G()||!document.body.classList.contains("my-account-page"))return;const e=localStorage.getItem("token"),i=localStorage.getItem("api_key"),s=localStorage.getItem("username");if(!e||!s||!i){console.error("Missing required authentication or user information.");return}const a=e.replace(/['"]+/g,""),n=s.replace(/['"]+/g,"");fetch(`https://v2.api.noroff.dev/auction/profiles/${n}/listings?_bids=true`,{method:"GET",headers:{"X-Noroff-API-Key":i,Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}).then(t=>{if(!t.ok)throw new Error("Failed to fetch listings");return t.json()}).then(t=>{const o=Array.isArray(t.data)?t.data:[];if(o.length===0){console.warn("No listings found for this user.");return}const d=document.getElementById("my-listings-container");if(!d){console.error("Listings container not found in DOM.");return}d.innerHTML="",o.filter(r=>{const u=r.endsAt?new Date(r.endsAt):null;return u&&u>new Date}).forEach(r=>{var l,h,y,w;const u=document.createElement("div");u.classList.add("flex","flex-col","p-4","bg-white","w-[350px]","rounded","shadow-md");const g=((h=(l=r.media)==null?void 0:l[0])==null?void 0:h.url)||"../../assets/placeholders/placeholder-pen-02.png",v=(y=r.bids)!=null&&y.length?Math.max(...r.bids.map(I=>I.amount)):"0",p=(w=r.tags)!=null&&w.length?r.tags.join(", "):"N/A",b=r.endsAt;let m="N/A";if(b){const E=new Date(b)-new Date;if(E>0){const L=Math.floor(E/864e5),S=Math.floor(E%(1e3*60*60*24)/(1e3*60*60)),B=Math.floor(E%(1e3*60)/(1e3*60));L>0?m=`${L} day${L>1?"s":""}`:S>0?m=`${S} hour${S>1?"s":""}`:m=`${B} minute${B>1?"s":""}`}else m="Ended"}u.innerHTML=`
                    <a href="/listing/view/index.html?id=${r.id}">
                        <img src="${g}" alt="${r.title}" class="mb-4 rounded object-cover w-full h-[220px]">
                        <h3 class="text-blue-950 font-bold text-lg">${r.title}</h3>
                        <div>
                            <span class="text-blue-950 font-bold">Current Bid:</span>
                            <span>${v} ðŸŒ•</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Description:</span>
                            <span class="italic">${r.description||"No description available"}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Category:</span>
                            <span>${p}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Ends in:</span>
                            <span>${m}</span>
                        </div>
                    </a>
                    <div class="mt-3 h-[50px]">
                        <a href="/listing/edit/index.html?id=${r.id}" class="bg-blue-950 hover:bg-blue-800 text-white rounded px-6 py-2">Edit</a>
                        <button data-listing-id="${r.id}" class="delete-listing-button bg-blue-950 hover:bg-blue-800 text-white rounded px-4 py-1.5 mt-2">Delete</button>
                    </div>
                `;const f=u.querySelector(".delete-listing-button");f&&f.addEventListener("click",()=>X(r.id,u)),d.appendChild(u)})}).catch(t=>{console.error("Error fetching listings:",t)})}function J(e){if(!e)return;const i=document.querySelectorAll(".profile-name");i.length>0&&i.forEach(c=>{c.textContent=e.name});const s=document.querySelector(".profile-email");s&&(s.textContent=e.email);const a=document.querySelectorAll(".avatar-profile");e.avatar&&a.length>0&&a.forEach(c=>{c.src=e.avatar});const n=document.querySelector(".banner-profile");e.banner&&n&&(n.src=e.banner);const t=document.querySelectorAll(".profile-credits");t.length>0&&t.forEach(c=>{c.textContent=`Credits: ${e.credits}`});const o=document.querySelector(".profile-listings-count");o&&(o.textContent=`Listings: ${e.listingsCount}`);const d=document.querySelector(".profile-wins-count");d&&(d.textContent=`Wins: ${e.winsCount}`)}async function ge(){document.addEventListener("DOMContentLoaded",async()=>{await me(),J()})}async function me(){let i=0;for(;i<5;){const s=localStorage.getItem("credits"),a=localStorage.getItem("listingsCount"),n=localStorage.getItem("winsCount");if(s&&a&&n)return;console.log(`Retrying to fetch profile data (${i+1}/5)...`),await N(),i++,await fe(500)}console.error("Failed to load profile data after multiple attempts.")}function fe(e){return new Promise(i=>setTimeout(i,e))}document.addEventListener("DOMContentLoaded",async function(){ee(),ne(),ge(),ie(),N(),(document.getElementById("register-form")?z():null)&&te();const i=localStorage.getItem("username");if(!i)return;const s=i.replace(/['"]+/g,""),a=document.querySelector(".logged-in-username");a&&(a.textContent=`Hello, ${s}! You are currently logged in.`),document.querySelectorAll(".visible-if-logged-in").forEach(t=>{t&&(t.style.display="block")}),de();try{await Promise.all([j(),U()]),ue()}catch(t){console.error("Error fetching required data:",t)}});const pe=()=>{const e=document.getElementById("logout-button");e&&e.addEventListener("click",function(){console.log("Logout button clicked"),localStorage.clear(),sessionStorage.clear(),window.location.pathname.endsWith("/index.html")||window.location.pathname==="/"?window.location.reload():window.location.href="../../index.html"})};async function he(){if(!document.body.classList.contains("create-listing-page"))return;const e=localStorage.getItem("token"),i=localStorage.getItem("api_key"),s=document.getElementById("new-listing-form"),a=document.getElementById("new-listing-title"),n=document.getElementById("new-listing-description"),t=document.getElementById("new-listing-category"),o=document.getElementById("new-listing-ends-at"),d=document.getElementById("new-listing-button");if(!s||!a||!n||!t||!o||!d){console.error("Required elements are missing.");return}d.addEventListener("click",async c=>{var b;c.preventDefault();const r=a.value.trim(),u=n.value.trim(),g=t.value.trim(),v=o.value.trim();if(!r||!u||!g||!v){alert("Please fill in all required fields.");return}const p=[];for(let m=1;m<=3;m++){const f=document.getElementById(`new-listing-image-${m}`).value.trim(),l=document.getElementById(`new-listing-image-alt-${m}`).value.trim();f&&l&&p.push({url:f,alt:l})}if(p.length===0){alert("Please provide at least one image with alt text.");return}try{const m=new Headers({"Content-Type":"application/json","X-Noroff-API-Key":i,Authorization:`Bearer ${e}`}),f=JSON.stringify({title:r,description:u,tags:g.split(",").map(w=>w.trim()),media:p,endsAt:v});console.log("Payload:",f);const l=await fetch("https://v2.api.noroff.dev/auction/listings",{method:"POST",headers:m,body:f});if(!l.ok)throw new Error(`Request failed: ${l.status} ${l.statusText}`);const h=await l.json();console.log("API Response:",h);const y=h.id||((b=h.data)==null?void 0:b.id);y?(alert("New listing created successfully!"),window.location.href=`/listing/view/index.html?id=${y}`):(console.error("Listing ID not found in the response."),alert("Failed to retrieve the listing ID. Please check your response."))}catch(m){console.error("Error creating new listing:",m),alert("Failed to create new listing.")}})}function ye(){const e=document.querySelectorAll(".dropdownButton"),i=document.querySelectorAll(".dropdownMenuBottom");if(!e.length||!i.length){console.error("Dropdown buttons or menus not found.");return}e.forEach((s,a)=>{s.addEventListener("click",()=>{const n=i[a];n&&n.classList.toggle("hidden")})}),document.addEventListener("click",s=>{i.forEach((a,n)=>{const t=e[n];!a.contains(s.target)&&!t.contains(s.target)&&a.classList.add("hidden")})})}async function we(){if(!document.body.classList.contains("view-profile-page"))return;const e=getUsernameFromURL(),i=localStorage.getItem("token"),s=localStorage.getItem("api_key");if(console.log("username: ",e),console.log("token: ",i),console.log("apiKey: ",s),!i)return console.error("No token found. User may not be logged in."),null;const a=new Headers;a.append("Authorization",`Bearer ${i}`),a.append("X-Noroff-API-Key",s);const n={method:"GET",headers:a,redirect:"follow"};try{const t=await fetch(`https://v2.api.noroff.dev/auction/profiles/${e}`,n);if(!t.ok)throw new Error(`Failed to fetch profile data: ${t.status} ${t.statusText}`);const o=await t.json(),d={name:o.data.name,email:o.data.email,avatar:o.data.avatar.url,banner:o.data.banner.url,credits:o.data.credits,listingsCount:o.data._count.listings,winsCount:o.data._count.wins};return localStorage.setItem("credits",o.data.credits),localStorage.setItem("listingsCount",o.data._count.listings),localStorage.setItem("winsCount",o.data._count.wins),localStorage.setItem("avatar",o.data.avatar.url),localStorage.setItem("banner",o.data.banner.url),d}catch(t){return console.error("Error fetching profile data:",t),null}}function ve(){if(!document.body.classList.contains("homepage"))return;const e=document.getElementById("carousel"),i=document.getElementById("prev-button"),s=document.getElementById("next-button"),a=document.getElementById("dots-container");async function n(){try{const o=await fetch("https://v2.api.noroff.dev/auction/listings?_bids=true",{method:"GET",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error("Failed to fetch listings");return(await o.json()).data.filter(c=>c.bids&&c.bids.length>0&&new Date(c.endsAt)>new Date).sort((c,r)=>Math.max(...r.bids.map(u=>u.amount))-Math.max(...c.bids.map(u=>u.amount))).slice(0,3)}catch(o){return console.error("Error fetching highest bid listings:",o),[]}}async function t(){const o=await n();if(o.length===0){console.error("No active listings with bids available.");return}e.classList.add("flex","transition-transform","duration-500","ease-in-out");const d=(p,b)=>p?p.length>b?p.slice(0,b)+"...":p:"";o.forEach(p=>{const b=Math.max(...p.bids.map(l=>l.amount)),m=p.media&&p.media[0]&&p.media[0].url?p.media[0].url:"default-image.jpg",f=document.createElement("div");f.classList.add("carousel-slide","relative","w-full","h-[500px]","shrink-0","flex","items-center","justify-center"),f.innerHTML=`
                <div class="absolute inset-0">
                    <img src="${m}" alt="${p.title}" class="w-full h-full object-cover break-words truncate">
                </div>
                <div class="absolute inset-0 bg-black bg-opacity-50 flex flex-col justify-center items-center text-white p-4">
                    <h3 class="text-3xl font-bold mb-4 break-words truncate">${d(p.title,20)}</h3>
                    <p class="text-xl mb-2"><strong>Highest Bid:</strong> ${b} ðŸŒ•</p>
                    <p class="text-xl mb-4"><strong>Ends in:</strong> ${be(p.endsAt)}</p>
                    <a href="/listing/view/index.html?id=${p.id}" class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-4 rounded">View Listing</a>
                </div>
            `,e.appendChild(f)}),o.forEach((p,b)=>{const m=document.createElement("div");m.classList.add("dot","w-3","h-3","bg-gray-400","rounded-full","cursor-pointer","mx-1"),m.addEventListener("click",()=>{c=b,u()}),a.appendChild(m)});let c=0;const r=o.length;function u(){const p=-c*100;e.style.transform=`translateX(${p}%)`,document.querySelectorAll(".dot").forEach((m,f)=>{f===c?(m.classList.add("bg-white","scale-125"),m.classList.remove("bg-gray-400","scale-100")):(m.classList.add("bg-gray-400","scale-100"),m.classList.remove("bg-white","scale-125"))})}function g(){c=(c+1)%r,u()}function v(){c=(c-1+r)%r,u()}s.addEventListener("click",g),i.addEventListener("click",v),u()}t()}function be(e){const a=new Date(e)-new Date;if(a>0){const n=Math.floor(a/864e5),t=Math.floor(a%(1e3*60*60*24)/(1e3*60*60)),o=Math.floor(a%(1e3*60*60)/(1e3*60));return n>0?`${n} day${n>1?"s":""}`:t>0?`${t} hour${t>1?"s":""}`:`${o} minute${o>1?"s":""}`}else return"Ended"}async function _(e,i=9){if(!document.body.classList.contains("homepage"))return;let s=1,a=[];const n=document.getElementById("listings-container"),t=document.getElementById("pagination-container"),o=document.getElementById("tag-filter"),d=document.querySelectorAll(".search-input"),c=document.getElementById("sort-filter");async function r(m,f=100){let l=[],h=1,y=!0;for(;y;)try{const w=await fetch(`${m}?_seller=true&_bids=true&limit=${f}&page=${h}`);if(!w.ok)throw new Error(`Failed to fetch listings: ${w.status}`);const I=await w.json();if(l=l.concat(I.data||[]),y=(I.data||[]).length===f,h++,l.length>=1e3)break}catch(w){console.error("Error fetching listings:",w),y=!1}return l}const u=await r(e);a=u.filter(m=>{const f=m.endsAt?new Date(m.endsAt):null;return f&&f>new Date});function g(m){const f=(m-1)*i,l=f+i,h=a.slice(f,l);n.innerHTML="",h.forEach(y=>{var $,k,A,H,F;const w=document.createElement("div");w.classList.add("flex","flex-col","p-4","bg-white","w-[320px]","rounded","shadow-md","h-auto");const I=((k=($=y.media)==null?void 0:$[0])==null?void 0:k.url)||"../../assets/placeholders/placeholder-pen-02.png",x=(A=y.bids)!=null&&A.length?Math.max(...y.bids.map(C=>C.amount)):"0",E=y.endsAt;let L="N/A";if(E){const T=new Date(E)-new Date;if(T>0){const D=Math.floor(T/864e5),q=Math.floor(T%(1e3*60*60*24)/(1e3*60*60)),R=Math.floor(T%(1e3*60*60)/(1e3*60));D>0?L=`${D} day${D>1?"s":""}`:q>0?L=`${q} hour${q>1?"s":""}`:L=`${R} minute${R>1?"s":""}`}else L="Ended"}function S(C,P){return C.length>P?C.slice(0,P)+"...":C}const B=(H=y.tags)==null?void 0:H.join(", ");w.innerHTML=`
            <img src="${I}" alt="${y.title}" class="mb-4 rounded h-[250px] object-cover">
            <h3 class="text-blue-950 font-bold text-lg break-words truncate">${y.title}</h3>
            <div>
                <span class="text-blue-950 font-bold">Current Bid:</span>
                <span>${x} ðŸŒ•</span>
            </div>
            <div>
                <span class="text-blue-950 font-bold">Description:</span>
                <span class="italic break-words">
                    ${y.description?S(y.description,30):"No description available"}
                </span>
            </div>
            <div>
                <span class="text-blue-950 font-bold">Ends in:</span>
                <span>${L}</span>
            </div>
            <div>
                <span class="text-blue-950 font-bold">Seller:</span>
                <span>${((F=y.seller)==null?void 0:F.name)||"Unknown"}</span>
            </div>
            ${B?`<div>
                <span class="text-blue-950 font-bold">Category:</span>
                <span>${B}</span>
            </div>`:""}
            <div class="flex grow"></div>
            <a href="/listing/view/index.html?id=${y.id}" class="mt-4 bg-blue-950 hover:bg-orange-600 text-white py-2 px-4 rounded text-center">View Listing</a>
        `,n.appendChild(w)})}function v(){t.innerHTML="";const m=Math.ceil(a.length/i),f=5,l=(w,I,x=!1)=>{const E=document.createElement("button");return E.textContent=w,E.classList.add("px-3","py-1","border","rounded","mx-1","bg-orange-500","hover:bg-orange-700","text-white"),x&&E.classList.add("bg-orange-600","text-white"),E.addEventListener("click",()=>{s=I,g(s),v()}),E};s>1&&(t.appendChild(l("1",1)),t.appendChild(l("Previous",s-1)));const h=Math.max(1,s-Math.floor(f/2)),y=Math.min(m,h+f-1);for(let w=h;w<=y;w++)t.appendChild(l(w,w,w===s));s<m&&(t.appendChild(l("Next",s+1)),t.appendChild(l(m,m)))}function p(){const m=Array.from(d).map(h=>h.value.toLowerCase()).join(" ").trim(),f=(o==null?void 0:o.value)||"",l=(c==null?void 0:c.value)||"";a=u.filter(h=>{var E,L,S,B,$,k;const y=h.endsAt?new Date(h.endsAt):null,w=y&&y>new Date,I=(!f||((E=h.tags)==null?void 0:E.includes(f)))&&w,x=!m||((L=h.title)==null?void 0:L.toLowerCase().includes(m))||((S=h.description)==null?void 0:S.toLowerCase().includes(m))||((B=h.tags)==null?void 0:B.some(A=>A.toLowerCase().includes(m)))||((k=($=h.seller)==null?void 0:$.name)==null?void 0:k.toLowerCase().includes(m));return I&&x}),l==="time-running-out"?a.sort((h,y)=>new Date(h.endsAt)-new Date(y.endsAt)):l==="newest-listings"?a.sort((h,y)=>new Date(y.createdAt)-new Date(h.createdAt)):l==="lowest-bids"?a.sort((h,y)=>{var x,E;const w=(x=h.bids)!=null&&x.length?Math.min(...h.bids.map(L=>L.amount)):0,I=(E=y.bids)!=null&&E.length?Math.min(...y.bids.map(L=>L.amount)):0;return w-I}):l==="highest-bids"&&a.sort((h,y)=>{var x,E;const w=(x=h.bids)!=null&&x.length?Math.max(...h.bids.map(L=>L.amount)):0;return((E=y.bids)!=null&&E.length?Math.max(...y.bids.map(L=>L.amount)):0)-w}),s=1,g(s),v()}function b(){if(!o)return;const m=new Set;u.forEach(f=>{const l=f.endsAt?new Date(f.endsAt):null;l&&l>new Date&&f.tags&&f.tags.forEach(h=>m.add(h))}),o.innerHTML="<option value=''>All Tags</option>",m.forEach(f=>{const l=document.createElement("option");l.value=f,l.textContent=f,o.appendChild(l)})}o&&o.addEventListener("change",p),d.length>0&&d.forEach(m=>m.addEventListener("input",p)),c&&c.addEventListener("change",p),b(),g(s),v()}async function O(e){const i=document.getElementById("search-input"),s=document.querySelector("main");if(!i||!s){console.error("Search input or main element not found.");return}async function a(t,o=100){let d=[],c=1,r=!0;for(;r;)try{const u=await fetch(`${t}?_seller=true&_bids=true&limit=${o}&page=${c}`);if(!u.ok)throw new Error(`Failed to fetch listings: ${u.status}`);const g=await u.json();if(d=d.concat(g.data||[]),r=(g.data||[]).length===o,c++,d.length>=1e3)break}catch(u){console.error("Error fetching listings:",u),r=!1}return console.log("Fetched Listings for Search:",d),d}async function n(t){console.log("Search Query:",t);const d=(await a(e)).filter(r=>{var f,l,h,y,w,I;const u=(f=r.title)==null?void 0:f.toLowerCase().includes(t),g=(l=r.description)==null?void 0:l.toLowerCase().includes(t),v=(w=(y=(h=r.media)==null?void 0:h[0])==null?void 0:y.alt)==null?void 0:w.toLowerCase().includes(t),p=(I=r.tags)==null?void 0:I.some(x=>x.toLowerCase().includes(t)),b=r.endsAt?new Date(r.endsAt):null,m=b&&b>new Date;return(u||g||v||p)&&m});if(console.log("Filtered Results:",d),s.innerHTML="",d.length===0){s.innerHTML=`
                <div class="text-center py-8">
                    <h2 class="text-xl font-bold">No results found</h2>
                    <p>Try adjusting your search query.</p>
                </div>
            `;return}const c=document.createElement("div");c.classList.add("flex","flex-wrap","gap-4","justify-center","p-4","items-center","mx-auto","bg-gray-100"),d.forEach(r=>{var f,l,h,y;const u=document.createElement("div");u.classList.add("flex","flex-col","p-4","bg-white","w-[320px]","rounded","shadow-md","h-auto");const g=((l=(f=r.media)==null?void 0:f[0])==null?void 0:l.url)||"../../assets/placeholders/placeholder-pen-02.png",v=(h=r.bids)!=null&&h.length?Math.max(...r.bids.map(w=>w.amount)):"0",p=r.endsAt;let b="N/A";if(p){const x=new Date(p)-new Date;if(x>0){const E=Math.floor(x/864e5),L=Math.floor(x%(1e3*60*60*24)/(1e3*60*60)),S=Math.floor(x%(1e3*60*60)/(1e3*60));E>0?b=`${E} day${E>1?"s":""}`:L>0?b=`${L} hour${L>1?"s":""}`:b=`${S} minute${S>1?"s":""}`}else b="Ended"}const m=(w,I)=>w?w.length>I?w.slice(0,I)+"...":w:"";u.innerHTML=`
                <img src="${g}" alt="${r.title}" class="mb-4 rounded h-[250px] object-cover">
                <h3 class="text-blue-950 font-bold text-lg break-words truncate">${r.title}</h3>
                <div>
                    <span class="text-blue-950 font-bold">Current Bid:</span>
                    <span>${v} ðŸŒ•</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Description:</span>
                    <span class="italic break-words">${m(r.description,30)}</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Ends in:</span>
                    <span>${b}</span>
                </div>
                <div>
                    <span class="text-blue-950 font-bold">Seller:</span>
                    <span>${((y=r.seller)==null?void 0:y.name)||"Unknown"}</span>
                </div>
                <a href="/listing/view/index.html?id=${r.id}" class="mt-4 bg-blue-950 text-white py-2 px-4 rounded text-center">View Listing</a>
            `,c.appendChild(u)}),s.appendChild(c)}i.addEventListener("input",()=>{const t=i.value.toLowerCase();n(t)})}async function Ee(){var a,n,t,o,d,c,r,u;if(!document.body.classList.contains("view-single-listing-page")||!G())return;const i=new URLSearchParams(window.location.search).get("id");if(!i){console.error("No listing ID found in URL");return}const s=`https://v2.api.noroff.dev/auction/listings/${i}?_seller=true&_bids=true`;try{const g=localStorage.getItem("token");if(!g){console.error("No token found. User may not be logged in.");return}const v=await fetch(s,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g}`}});if(!v.ok)throw new Error("Failed to fetch listing");const{data:p}=await v.json();document.querySelector(".view-single-listing-title").textContent=p.title||"No title available",document.querySelector(".view-single-listing-description").textContent=p.description||"No description available",document.querySelector(".single-listing-tags").textContent=((a=p.tags)==null?void 0:a.join(", "))||"No tags available";const b=p.endsAt?new Date(p.endsAt):null;let m="N/A";if(b){const x=b-new Date;if(x>0){const E=Math.floor(x/864e5),L=Math.floor(x%(1e3*60*60*24)/(1e3*60*60)),S=Math.floor(x%(1e3*60*60)/(1e3*60));E>0?m=`${E} day${E>1?"s":""}`:L>0?m=`${L} hour${L>1?"s":""}`:m=`${S} minute${S>1?"s":""}`}else m="Ended"}document.querySelector(".single-listing-endat").textContent=m;const f=document.querySelector(".view-single-listing-carousel"),l=p.media||[];if(l.length>0){let I=0;const x=()=>{var $,k;const E=document.querySelector(".view-single-listing-image"),L=document.querySelector(".view-single-listing-image-alt-text");E.src=(($=l[I])==null?void 0:$.url)||"../../assets/placeholders/placeholder-pen.png",L.textContent=((k=l[I])==null?void 0:k.alt)||"No image description available";const S=document.getElementById("carousel-left-button"),B=document.getElementById("carousel-right-button");l.length===1?(S.style.display="none",B.style.display="none"):(S.style.display="inline-block",B.style.display="inline-block"),S.disabled=I<=0,B.disabled=I>=l.length-1};f.innerHTML=`
                <div class="carousel-image-container">
                    <img src="${l[0].url}" alt="${l[0].alt}" class="view-single-listing-image w-full h-[500px] object-cover">
                </div>
                <div class="view-single-listing-image-alt-text text-center italic text-blue-950 text-xs">${l[0].alt}</div>
                <div class="carousel-controls flex justify-center gap-4 mt-2">
                    <button id="carousel-left-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">â—€</button>
                    <button id="carousel-right-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">â–¶</button>
                </div>
            `,document.getElementById("carousel-left-button").addEventListener("click",()=>{I>0&&(I--,x())}),document.getElementById("carousel-right-button").addEventListener("click",()=>{I<l.length-1&&(I++,x())}),x()}else f.innerHTML=`
                <img src="../../assets/placeholders/placeholder-pen.png" alt="No image available" class="view-single-listing-image w-full h-[500px] object-cover">
                <div class="view-single-listing-image-alt-text text-center italic text-blue-950 text-xs">No image alt text available</div>
            `;document.querySelector(".view-single-listing-seller-avatar").src=((t=(n=p.seller)==null?void 0:n.avatar)==null?void 0:t.url)||"../../assets/placeholders/avatar-placeholder.png",document.querySelector(".view-single-listing-seller-name").textContent=((o=p.seller)==null?void 0:o.name)||"Unknown Seller";const h=(d=p.bids)!=null&&d.length?Math.max(...p.bids.map(I=>I.amount)):"0";document.querySelector(".highest-bid-on-single-listing").textContent=`${h} ðŸŒ•`;let y="No bids yet";if((c=p.bids)!=null&&c.length){const I=p.bids.reduce((x,E)=>E.amount>x.amount?E:x);y=((r=I==null?void 0:I.bidder)==null?void 0:r.name)||"Anonymous"}document.querySelector(".higest-bidder-dame").textContent=y;const w=document.querySelector(".bid-history-table");w&&((u=p.bids)!=null&&u.length)&&(w.innerHTML="",[...p.bids].sort((x,E)=>new Date(E.created)-new Date(x.created)).forEach(x=>{var L,S,B;const E=document.createElement("div");E.classList.add("bid-history-table","bg-white","flex","justify-between","p-4","m-4","items-center","text-blue-950","w-full"),E.innerHTML=`
                    <div>
                        <img src="${((S=(L=x.bidder)==null?void 0:L.avatar)==null?void 0:S.url)||"../../assets/placeholders/avatar-placeholder.png"}" alt="avatar"
                        class="bid-history-avatar w-[50px] h-[50px] object-cover mx-auto rounded-full overflow-hidden">
                    </div>
                    <div class="bid-history-username font-bold">${((B=x.bidder)==null?void 0:B.name)||"Anonymous"}</div>
                    <div class="bid-history-date">${new Date(x.created).toLocaleDateString()}</div>
                    <div class="bid-history-amount-of-bid font-bold">${x.amount} ðŸŒ•</div>
                `,w.appendChild(E)}))}catch(g){console.error("Error fetching single listing:",g)}}function Ie(){if(!document.body.classList.contains("view-single-listing-page"))return;const e=document.querySelector(".copy-link-to-listing");if(!e){console.error("Copy link element not found in the DOM.");return}e.addEventListener("click",()=>{const i=window.location.href;navigator.clipboard.writeText(i).then(()=>{alert("Successfully copied the link to this listing")}).catch(s=>{console.error("Failed to copy the link:",s),alert("Failed to copy the link. Please try again.")})})}function xe(){if(!document.body.classList.contains("view-single-listing-page"))return;const e=document.getElementById("place-bid-button"),i=document.getElementById("place-bid");if(!e||!i){console.error("Bid button or input field not found.");return}e.addEventListener("click",async s=>{s.preventDefault();const a=parseFloat(i.value);if(isNaN(a)||a<=0){alert("Please enter a valid bid amount.");return}const t=new URLSearchParams(window.location.search).get("id");if(!t){console.error("Listing ID not found in the URL."),alert("Could not determine the listing to place a bid.");return}const o=localStorage.getItem("api_key"),d=localStorage.getItem("token");if(!o||!d){console.error("API key or access token not found in localStorage."),alert("Unable to authenticate. Please log in again.");return}const c={method:"POST",headers:{"X-Noroff-API-Key":o,"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({amount:a})};try{console.log(`Placing bid on listing ${t} with amount ${a}`);const r=await fetch(`https://v2.api.noroff.dev/auction/listings/${t}/bids`,c);if(!r.ok){const g=await r.json();console.error("Error response from API:",g),alert(`Error placing bid: ${g.message||"An unexpected error occurred."}`);return}const u=await r.json();console.log("Bid placed successfully:",u),alert("Bid placed successfully!"),location.reload()}catch(r){console.error("Error placing bid:",r),alert("An error occurred while placing your bid. Please try again later.")}})}function Le(){if(!document.body.classList.contains("my-account-page"))return;const e=localStorage.getItem("token"),i=localStorage.getItem("api_key"),s=localStorage.getItem("username"),a=e.replace(/['"]+/g,""),n=s.replace(/['"]+/g,"");fetch(`https://v2.api.noroff.dev/auction/profiles/${n}?_wins=true`,{method:"GET",headers:{"X-Noroff-API-Key":i,Authorization:`Bearer ${a}`,"Content-Type":"application/json"}}).then(t=>{if(t.ok)return t.json();throw new Error("Failed to fetch user wins")}).then(t=>{var c;const o=((c=t==null?void 0:t.data)==null?void 0:c.wins)||[];if(o.length===0){console.log("No won listings found.");return}const d=document.getElementById("user-wins-container");if(!d){console.error("User wins container not found in the DOM");return}d.innerHTML="",o.forEach(r=>{var v,p,b;const u=document.createElement("div");u.classList.add("flex","flex-col","p-4","bg-white","w-[320px]","rounded","shadow-md","h-auto");const g=((p=(v=r.media)==null?void 0:v[0])==null?void 0:p.url)||"../../assets/placeholders/placeholder-pen-02.png";u.innerHTML=`
                    <a href="/listing/view/index.html?id=${r.id}" class="block">
                        <img src="${g}" alt="${r.title}" class="mb-4 rounded h-[250px] object-cover">
                        <h3 class="text-blue-950 font-bold text-lg break-words truncate">${r.title}</h3>
                        <div>
                            <span class="text-blue-950 font-bold">Description:</span>
                            <span class="italic break-words">${r.description||"No description available"}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Category:</span>
                            <span>${((b=r.tags)==null?void 0:b.join(", "))||"N/A"}</span>
                        </div>
                        <div>
                            <span class="text-blue-950 font-bold">Ended At:</span>
                            <span>${new Date(r.endsAt).toLocaleDateString()||"Unknown"}</span>
                        </div>
                    </a>
                `,d.appendChild(u)})}).catch(t=>{console.error("Error fetching user wins:",t)})}function Se(){if(!document.body.classList.contains("create-listing-page"))return;const e=document.getElementById("new-listing-title"),i=document.getElementById("new-listing-description"),s=document.getElementById("new-listing-category"),a=[document.getElementById("new-listing-image-1"),document.getElementById("new-listing-image-2"),document.getElementById("new-listing-image-3")],n=[document.getElementById("new-listing-image-alt-1"),document.getElementById("new-listing-image-alt-2"),document.getElementById("new-listing-image-alt-3")],t=document.querySelector(".review-new-listing-title"),o=document.querySelector(".review-new-listing-description"),d=document.querySelector(".review-new-listing-tags"),c=document.querySelector(".review-new-listing-image"),r=document.querySelector(".review-new-listing-image-alt-text"),u=document.createElement("button"),g=document.createElement("button");u.textContent="â—€",g.textContent="â–¶";let v=0;const p=()=>{var h,y;const f=a.filter(w=>w.value),l=f.length;l>0?(v=Math.min(v,l-1),c.src=((h=f[v])==null?void 0:h.value)||"../../assets/placeholders/placeholder-pen.png",r.textContent=((y=n[v])==null?void 0:y.value)||"Image alt text goes here"):(c.src="../../assets/placeholders/placeholder-pen.png",r.textContent="Image alt text goes here"),u.disabled=v<=0,g.disabled=v>=l-1},b=()=>{t.textContent=e.value||"Listing title",o.textContent=i.value||"Lorem ipsum description goes here...",d.textContent=s.value||"Category",p()};u.addEventListener("click",()=>{v>0&&(v--,p())}),g.addEventListener("click",()=>{const f=a.filter(l=>l.value).length;v<f-1&&(v++,p())}),e.addEventListener("input",b),i.addEventListener("input",b),s.addEventListener("input",b),a.forEach(f=>f.addEventListener("input",p)),n.forEach(f=>f.addEventListener("input",p));const m=document.querySelector(".review-new-listing-carousel");m.appendChild(u),m.appendChild(g),b()}async function Be(){var m;if(!document.body.classList.contains("edit-listing-page"))return;const e=localStorage.getItem("token");localStorage.getItem("api_key");const s=new URLSearchParams(window.location.search).get("id");if(!s){console.error("No listing ID found in URL.");return}const a=`https://v2.api.noroff.dev/auction/listings/${s}?_seller=true&_bids=true`,n=document.getElementById("edit-listing-title"),t=document.getElementById("edit-listing-description"),o=document.getElementById("edit-listing-category"),d=[document.getElementById("edit-listing-image-1"),document.getElementById("edit-listing-image-2"),document.getElementById("edit-listing-image-3")],c=[document.getElementById("edit-listing-image-alt-1"),document.getElementById("edit-listing-image-alt-2"),document.getElementById("edit-listing-image-alt-3")],r=document.querySelector(".view-edit-listing-title"),u=document.querySelector(".view-edit-listing-description"),g=document.querySelector(".edit-listing-tags"),v=document.querySelector(".view-edit-listing-image"),p=document.querySelector(".view-edit-listing-image-alt-text"),b=()=>{var h,y;r.textContent=n.value||"Listing title",u.textContent=t.value||"Lorem ipsum description goes here...",g.textContent=o.value||"Category";const f=((h=d[0])==null?void 0:h.value)||"../../assets/placeholders/placeholder-pen.png",l=((y=c[0])==null?void 0:y.value)||"Image alt text goes here";v.src=f,p.textContent=l};try{const f=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!f.ok)throw new Error("Failed to fetch listing details.");const l=await f.json();n.value=l.title||"",t.value=l.description||"",o.value=((m=l.tags)==null?void 0:m.join(", "))||"",(l.media||[]).forEach((y,w)=>{d[w]&&(d[w].value=y.url||"",c[w].value=y.alt||"")}),b()}catch(f){console.error("Error fetching listing details:",f)}n.addEventListener("input",b),t.addEventListener("input",b),o.addEventListener("input",b),d.forEach((f,l)=>{var h;f.addEventListener("input",b),(h=c[l])==null||h.addEventListener("input",b)})}async function V(){var n;if(!document.body.classList.contains("edit-listing-page"))return;const e=localStorage.getItem("token");if(!e){console.error("No token found. User may not be logged in.");return}const s=new URLSearchParams(window.location.search).get("id");if(!s){console.error("No listing ID found in the URL.");return}const a=`https://v2.api.noroff.dev/auction/listings/${s}?_seller=true&_bids=true`;console.log("Fetching listing from:",a);try{const t=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`}});if(!t.ok)throw new Error(`Failed to fetch listing. Status: ${t.status}`);const o=await t.json();if(console.log("Fetched listing data:",o),!o||!o.data)throw new Error("Invalid listing data received from the API.");$e(o.data),Y(o.data.media);const d=(n=o.data.bids)!=null&&n.length?Math.max(...o.data.bids.map(r=>r.amount)):"0",c=document.querySelector(".highest-bid-on-edit-listing");c?c.textContent=`${d} ðŸŒ•`:console.warn("Highest bid element not found in the DOM.")}catch(t){console.error("Error fetching or populating listing data:",t)}}function $e(e){var i,s,a,n,t;console.log("Populating input fields..."),document.getElementById("edit-listing-title").value=e.title||"",document.getElementById("edit-listing-description").value=e.description||"",document.getElementById("edit-listing-category").value=((i=e.tags)==null?void 0:i.join(", "))||"";for(let o=0;o<3;o++){const d=document.getElementById(`edit-listing-image-${o+1}`),c=document.getElementById(`edit-listing-image-alt-${o+1}`);d&&(d.value=((a=(s=e.media)==null?void 0:s[o])==null?void 0:a.url)||""),c&&(c.value=((t=(n=e.media)==null?void 0:n[o])==null?void 0:t.alt)||"")}console.log("Input fields populated with:",{title:e.title,description:e.description,tags:e.tags})}function Y(e=[]){console.log("Updating edit listing preview...");const i=document.getElementById("edit-listing-title").value||"No title available",s=document.getElementById("edit-listing-description").value||"No description available",a=document.getElementById("edit-listing-category").value||"No category available";document.querySelector(".view-edit-listing-title").textContent=i,document.querySelector(".view-edit-listing-description").textContent=s,document.querySelector(".edit-listing-tags").textContent=a;const n=document.querySelector(".view-edit-listing-carousel");if(!n){console.error("Carousel container not found.");return}if(e.length>0){let t=0;const o=()=>{var g,v;const d=document.querySelector(".view-edit-listing-image"),c=document.querySelector(".view-edit-listing-image-alt-text");d&&c&&(d.src=((g=e[t])==null?void 0:g.url)||"../../assets/placeholders/placeholder-pen.png",c.textContent=((v=e[t])==null?void 0:v.alt)||"No description available");const r=document.getElementById("carousel-left-button"),u=document.getElementById("carousel-right-button");e.length===1?(r.style.display="none",u.style.display="none"):(r.style.display="inline-block",u.style.display="inline-block"),r.disabled=t<=0,u.disabled=t>=e.length-1};n.innerHTML=`
            <div class="carousel-image-container">
                <img src="${e[0].url}" alt="${e[0].alt}" class="view-edit-listing-image w-full h-[500px] object-cover">
            </div>
            <div class="view-edit-listing-image-alt-text text-center italic text-blue-950 text-xs">${e[0].alt}</div>
            <div class="carousel-controls flex justify-center gap-4 mt-2">
                <button id="carousel-left-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">â—€</button>
                <button id="carousel-right-button" class="carousel-button px-4 py-2 bg-orange-500 hover:bg-orange-600 text-white rounded">â–¶</button>
            </div>
        `,document.getElementById("carousel-left-button").addEventListener("click",()=>{t>0&&(t--,o())}),document.getElementById("carousel-right-button").addEventListener("click",()=>{t<e.length-1&&(t++,o())}),o()}else n.innerHTML=`
            <img src="../../assets/placeholders/placeholder-pen.png" alt="No image available" class="view-edit-listing-image w-full h-[500px] object-cover">
            <div class="view-edit-listing-image-alt-text text-center italic text-blue-950 text-xs">No image alt text available</div>
        `;console.log("Preview updated with:",{title:i,description:s,category:a})}document.addEventListener("DOMContentLoaded",async()=>{await V(),["edit-listing-title","edit-listing-description","edit-listing-category","edit-listing-image-1","edit-listing-image-2","edit-listing-image-3","edit-listing-image-alt-1","edit-listing-image-alt-2","edit-listing-image-alt-3"].forEach(e=>{const i=document.getElementById(e);i&&i.addEventListener("input",()=>{const s=Array.from({length:3},(a,n)=>{var t,o;return{url:(t=document.getElementById(`edit-listing-image-${n+1}`))==null?void 0:t.value,alt:(o=document.getElementById(`edit-listing-image-alt-${n+1}`))==null?void 0:o.value}}).filter(a=>a.url);Y(s)})})});async function M(e){if(!document.body.classList.contains("edit-listing-page"))return;e.preventDefault();const i=localStorage.getItem("token");if(!i){console.error("No token found. User may not be logged in.");return}const a=new URLSearchParams(window.location.search).get("id");if(!a){console.error("No listing ID found in the URL.");return}const n=`https://v2.api.noroff.dev/auction/listings/${a}`,t=document.getElementById("edit-listing-title").value,o=document.getElementById("edit-listing-description").value,d=document.getElementById("edit-listing-category").value.split(",").map(g=>g.trim()).filter(g=>g),c=[];for(let g=1;g<=3;g++){const v=document.getElementById(`edit-listing-image-${g}`).value,p=document.getElementById(`edit-listing-image-alt-${g}`).value;v&&c.push({url:v,alt:p||"No description available"})}const r={title:t,description:o,tags:d,media:c},u=localStorage.getItem("api_key");try{const g=await fetch(n,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${i}`,"X-Noroff-API-Key":u},body:JSON.stringify(r)});if(!g.ok)throw new Error(`Failed to save listing. Status: ${g.status}`);alert("Listing successfully updated!"),window.location.href=`../../listing/view/index.html?id=${a}`}catch(g){console.error("Error saving listing:",g),alert("Failed to save the listing. Please try again.")}}function ke(){const e=document.getElementById("edit-listing-button");e&&e.addEventListener("click",M)}function Ce(){if(!document.body.classList.contains("my-account-page"))return;const e=3,i="pageRefreshCount",s="fresh",a=1e3;if(localStorage.getItem(s))return;let n=parseInt(localStorage.getItem(i))||0;n<e?(n++,localStorage.setItem(i,n),console.log(`Waiting ${a/1e3} seconds before refreshing... (${n}/${e})`),setTimeout(()=>{location.reload()},a)):(console.log('Maximum refresh attempts reached. Setting "fresh" in localStorage.'),localStorage.setItem(s,"true"),localStorage.removeItem(i))}document.addEventListener("DOMContentLoaded",async function(){Ce(),pe(),he(),ve(),Ee(),Ie(),xe(),ye(),Le(),Se(),Be(),V(),M(),ke();try{const n=await fetch("https://v2.api.noroff.dev/auction/listings?_bids=true",{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error("Failed to fetch listings");const o=(await n.json()).data||[];_(o),_("https://v2.api.noroff.dev/auction/listings"),O(o),O("https://v2.api.noroff.dev/auction/listings")}catch(n){console.error("Error fetching listings:",n)}const e=await we();e&&J(e);const i=localStorage.getItem("username");if(i){const n=i.replace(/['"]+/g,""),t=document.querySelector(".logged-in-username");t&&(t.textContent="Hello, "+n+"! You are currently logged in.");const o=document.querySelector(".visible-if-logged-in");o&&(o.style.display="block")}const s=document.getElementById("edit-listing-button");s&&s.addEventListener("click",M);const a=document.querySelectorAll(".delete-listing-button");a.length,a.forEach(n=>{const t=n.getAttribute("data-listing-id"),o=n.closest(".listing-card");if(!t||!o){console.error("Missing listing ID or listing card for delete button.");return}console.log(`Attaching delete listener to listing ID: ${t}`),n.addEventListener("click",()=>{X(t,o)})})});
